<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Claudio's Christmas Jeopardy</title>

<style>
  :root{
    --bg:#060612;
    --panel: rgba(255,255,255,.06);
    --panel2: rgba(255,255,255,.04);
    --text:#f2f5ff;
    --muted:#cfe0ff;

    --neon:#00e5ff;
    --pink:#ff2bd6;
    --green:#7CFF6B;
    --gold:#ffd24a;
    --red:#ff4d4d;

    --ice:#bfe9ff;

    --radius:18px;
    --shadow: 0 0 14px rgba(0,229,255,.35), 0 0 34px rgba(255,43,214,.14);
    --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;

    --focus: rgba(255,210,74,.95);
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:var(--font);
    color:var(--text);

    /* upgraded “winter sky + aurora + stars” background */
    background:
      radial-gradient(900px 520px at 15% 10%, rgba(0,229,255,.20), transparent 62%),
      radial-gradient(900px 520px at 90% 16%, rgba(255,43,214,.16), transparent 62%),
      radial-gradient(800px 520px at 55% 95%, rgba(45,255,106,.12), transparent 62%),
      radial-gradient(1200px 800px at 50% 50%, rgba(255,210,74,.06), transparent 70%),
      linear-gradient(180deg, #07071a, #04040c 70%, #04040c);

    overflow-x:hidden;
  }

  /* subtle starfield layer */
  .stars{
    position:fixed; inset:0; pointer-events:none; z-index:0;
    opacity:.45;
    background:
      radial-gradient(1px 1px at 12% 22%, rgba(255,255,255,.90), transparent 55%),
      radial-gradient(1px 1px at 24% 68%, rgba(191,233,255,.90), transparent 55%),
      radial-gradient(1px 1px at 36% 30%, rgba(255,255,255,.75), transparent 55%),
      radial-gradient(1px 1px at 52% 12%, rgba(255,255,255,.85), transparent 55%),
      radial-gradient(1px 1px at 68% 26%, rgba(191,233,255,.75), transparent 55%),
      radial-gradient(1px 1px at 76% 70%, rgba(255,255,255,.80), transparent 55%),
      radial-gradient(1px 1px at 90% 18%, rgba(255,255,255,.92), transparent 55%),
      radial-gradient(1px 1px at 92% 62%, rgba(191,233,255,.85), transparent 55%);
    filter: drop-shadow(0 0 10px rgba(191,233,255,.10));
  }

  /* aurora glow sweep */
  .aurora{
    position:fixed; inset:-20%;
    pointer-events:none; z-index:0;
    background:
      radial-gradient(900px 500px at 25% 30%, rgba(0,229,255,.10), transparent 70%),
      radial-gradient(900px 500px at 70% 40%, rgba(255,43,214,.08), transparent 70%),
      radial-gradient(900px 500px at 55% 65%, rgba(45,255,106,.08), transparent 70%);
    mix-blend-mode: screen;
    filter: blur(18px);
    opacity:.55;
    animation: auroraDrift 12s ease-in-out infinite alternate;
  }
  @keyframes auroraDrift{
    0%{ transform: translate3d(-1%, -1%, 0) rotate(-1deg); opacity:.45; }
    100%{ transform: translate3d(1%, 1%, 0) rotate(1deg); opacity:.62; }
  }

  /* ===== Snowflakes (SVG flakes) ===== */
  .snow{position:fixed; inset:0; pointer-events:none; z-index:1; opacity:.70}
  .flake{
    position:absolute; top:-40px;
    width:18px; height:18px;
    will-change: transform, opacity;
    animation: fall linear infinite;
    opacity:.9;
  }
  .flake svg{width:100%; height:100%;}
  @keyframes fall{
    to{
      transform:
        translateY(115vh)
        translateX(var(--drift, 0px))
        rotate(var(--rotEnd, 240deg));
      opacity:.10;
    }
  }

  .wrap{max-width:1240px;margin:0 auto;padding:16px 14px 28px; position:relative; z-index:2}
  header{
    display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;
    padding:8px 2px 14px;
  }
  .brand{display:flex;align-items:center;gap:12px}
  .badge{
    width:52px;height:52px;border-radius:18px;
    background: linear-gradient(135deg, rgba(255,59,59,.95), rgba(45,255,106,.75));
    box-shadow: 0 0 0 1px rgba(255,255,255,.12), var(--shadow);
    position:relative;
  }
  .badge:after{
    content:"";
    position:absolute; inset:10px;
    border-radius:12px;
    border:2px solid rgba(255,255,255,.35);
  }

  /* ===== Title glitter effect ===== */
  .titleWrap{display:flex;flex-direction:column;gap:2px; position:relative}
  h1{
    margin:0;
    font-size:34px;
    line-height:1.05;
    letter-spacing:.6px;
    font-weight:1200;
    text-shadow:
      0 0 18px rgba(0,229,255,.22),
      0 0 22px rgba(255,43,214,.16),
      0 0 34px rgba(255,210,74,.12);
    position:relative;
    display:inline-block;
    padding:4px 6px;
  }
  h1::before{
    content:"";
    position:absolute;
    inset:-10px -14px -12px -14px;
    border-radius:18px;
    background:
      radial-gradient(200px 80px at 20% 40%, rgba(255,210,74,.25), transparent 60%),
      radial-gradient(220px 90px at 80% 60%, rgba(0,229,255,.22), transparent 60%),
      linear-gradient(90deg, rgba(255,43,214,.10), rgba(0,229,255,.10), rgba(45,255,106,.08));
    opacity:.95;
    z-index:-2;
    animation: glowSweep 4.8s ease-in-out infinite;
    border:1px solid rgba(255,255,255,.10);
  }
  h1::after{
    content:"";
    position:absolute;
    inset:-14px -18px -16px -18px;
    border-radius:20px;
    background:
      radial-gradient(2px 2px at 10% 25%, rgba(255,255,255,.95), transparent 60%),
      radial-gradient(2px 2px at 22% 70%, rgba(191,233,255,.95), transparent 60%),
      radial-gradient(2px 2px at 40% 35%, rgba(255,210,74,.95), transparent 60%),
      radial-gradient(2px 2px at 55% 65%, rgba(255,255,255,.92), transparent 60%),
      radial-gradient(2px 2px at 70% 30%, rgba(0,229,255,.95), transparent 60%),
      radial-gradient(2px 2px at 88% 60%, rgba(255,43,214,.95), transparent 60%),
      radial-gradient(2px 2px at 92% 25%, rgba(255,255,255,.92), transparent 60%);
    opacity:.55;
    z-index:-1;
    animation: twSpark 2.6s ease-in-out infinite;
    pointer-events:none;
  }
  @keyframes glowSweep{
    0%,100%{transform: translateY(0px); filter: brightness(1) blur(0.2px)}
    50%{transform: translateY(-1px); filter: brightness(1.25) blur(0.3px)}
  }
  @keyframes twSpark{
    0%,100%{opacity:.40; filter: brightness(1)}
    50%{opacity:.78; filter: brightness(1.35)}
  }

  .sub{
    margin-top:2px;
    color:var(--muted);
    font-size:13px;
    letter-spacing:.35px;
    font-weight:900;
  }

  .topbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{
    cursor:pointer;border:none;border-radius:14px;
    padding:10px 12px;
    font-weight:900;letter-spacing:.2px;
    color:var(--text);
    background: linear-gradient(135deg, rgba(0,229,255,.20), rgba(255,43,214,.14));
    border:1px solid rgba(255,255,255,.12);
    box-shadow: 0 0 0 1px rgba(0,229,255,.10);
    user-select:none;
    transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
  }
  .btn:hover{transform: translateY(-1px); box-shadow: var(--shadow)}
  .btn:active{transform: translateY(0px) scale(.99); filter:brightness(.95)}
  .btn.red{background: linear-gradient(135deg, rgba(255,59,59,.24), rgba(255,43,214,.10));}
  .btn.green{background: linear-gradient(135deg, rgba(45,255,106,.20), rgba(0,229,255,.10));}
  .btn.gold{background: linear-gradient(135deg, rgba(255,210,74,.22), rgba(255,43,214,.10));}
  .btn.ghost{background: rgba(0,0,0,.18);}

  .layout{display:grid;grid-template-columns:1fr 410px;gap:14px;align-items:start}
  @media(max-width: 980px){.layout{grid-template-columns:1fr}}

  .panel{
    background: var(--panel);
    border:1px solid rgba(255,255,255,.10);
    border-radius: var(--radius);
    box-shadow: 0 0 0 1px rgba(255,255,255,.04), 0 18px 55px rgba(0,0,0,.45);
    padding:14px;
  }

  .grid{display:grid;grid-template-columns:repeat(6, 1fr);gap:10px}
  @media(max-width: 980px){.grid{grid-template-columns:repeat(3,1fr)}}
  @media(max-width: 520px){.grid{grid-template-columns:repeat(2,1fr)}}

  .cat{
    background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
    border:1px solid rgba(255,255,255,.10);
    border-radius: 16px;
    padding:10px 8px;
    text-align:center;
    font-weight:1100;
    font-size:12px;
    letter-spacing:.6px;
    text-transform:uppercase;
    position:relative;
    overflow:hidden;
  }
  .cat:before{
    content:"";
    position:absolute; inset:-40%;
    background: conic-gradient(from 120deg, transparent, rgba(255,59,59,.18), transparent, rgba(45,255,106,.18), transparent);
    animation: spin 10s linear infinite;
    opacity:.7;
  }
  .cat > span{position:relative}
  @keyframes spin{to{transform:rotate(360deg)}}

  .tile{
    height:84px;border-radius:18px;
    background: linear-gradient(180deg, rgba(17,17,70,.95), rgba(10,10,40,.95));
    border:1px solid rgba(255,255,255,.12);
    display:flex;align-items:center;justify-content:center;
    font-weight:1100;font-size:26px;
    color: rgba(255,210,74,.95);
    text-shadow: 0 0 18px rgba(255,210,74,.22), 0 0 16px rgba(0,229,255,.14);
    cursor:pointer;user-select:none;
    transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease, outline .08s ease;
    position:relative;
    overflow:hidden;
  }
  .tile:hover{transform: translateY(-2px); box-shadow: var(--shadow)}
  .tile.used{opacity:.22;cursor:not-allowed;filter:saturate(.6);text-shadow:none}
  .tile:focus{
    outline: 4px solid rgba(255,210,74,.85);
    box-shadow: 0 0 0 2px rgba(0,0,0,.35), var(--shadow);
    transform: translateY(-2px);
  }
  .tile.active{
    outline: 4px solid rgba(0,229,255,.85);
    box-shadow: 0 0 0 2px rgba(0,0,0,.35), var(--shadow);
  }

  .side{display:grid;gap:14px}
  .sectionTitle{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:0 0 10px;font-weight:1100}
  .mini{font-size:12px;color:var(--muted);font-weight:800}

  .timerBox{display:flex;align-items:center;justify-content:space-between;gap:10px}
  .time{font-size:34px;font-weight:1200;letter-spacing:1px;min-width:98px;text-align:right;text-shadow:0 0 16px rgba(0,229,255,.22)}
  .time.warn{color:var(--gold)}
  .time.danger{color:var(--red)}
  .timerBtns{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}

  input[type="number"], input[type="text"], select{
    background: rgba(0,0,0,.18);
    border:1px solid rgba(255,255,255,.16);
    border-radius:12px;
    padding:9px 10px;
    color:var(--text);
    outline:none;
    font-weight:900;
  }
  input[type="number"]{width:120px}

  .teams{display:grid;gap:10px}
  .team{
    display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;
    padding:10px;border-radius:16px;
    border:1px solid rgba(255,255,255,.10);
    background: var(--panel2);
  }
  .teamName{display:flex;align-items:baseline;gap:8px;flex-wrap:wrap;font-weight:1100}
  .score{font-size:18px;font-weight:1200;color: rgba(0,229,255,.95);text-shadow:0 0 14px rgba(0,229,255,.18)}
  .scoreBtns{display:flex;gap:6px;flex-wrap:wrap;justify-content:flex-end}

  /* Host */
  .hostRow{display:grid;grid-template-columns: 138px 1fr;gap:12px;align-items:center}
  .hostStage{
    width:138px;height:138px;border-radius:24px;
    background: radial-gradient(circle at 30% 20%, rgba(191,233,255,.22), transparent 55%),
                radial-gradient(circle at 80% 20%, rgba(255,59,59,.20), transparent 55%),
                radial-gradient(circle at 60% 90%, rgba(45,255,106,.16), transparent 55%),
                rgba(0,0,0,.12);
    border:1px solid rgba(255,255,255,.12);
    display:flex;align-items:center;justify-content:center;
    box-shadow: 0 0 0 1px rgba(0,229,255,.10);
    position:relative; overflow:hidden;
  }
  .hostStage:before{
    content:"";
    position:absolute; inset:-40%;
    background: conic-gradient(from 90deg, transparent, rgba(0,229,255,.12), transparent, rgba(255,43,214,.12), transparent);
    animation: spin 12s linear infinite;
    opacity:.65;
  }
  .host{
    width:124px;height:124px; position:relative; z-index:1;
    animation: hostBob 2.3s ease-in-out infinite;
    transform-origin: 50% 70%;
    filter: drop-shadow(0 0 14px rgba(0,229,255,.20));
  }
  @keyframes hostBob{0%,100%{transform: translateY(0px)}50%{transform: translateY(-5px)}}
  .host[data-mood="buzz"]{animation: hostBob 2.3s ease-in-out infinite, hostShake .20s ease-in-out 2;}
  @keyframes hostShake{
    0%,100%{transform: translateY(-5px) rotate(0deg)}
    30%{transform: translateY(-5px) rotate(-6deg)}
    70%{transform: translateY(-5px) rotate(6deg)}
  }
  .bubble{
    border-radius:18px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.18);
    padding:10px 12px;
    position:relative;
    box-shadow: 0 0 0 1px rgba(255,255,255,.04);
    min-height:84px;
  }
  .bubble:before{
    content:"";
    position:absolute; left:-8px; top:26px;
    width:16px;height:16px;
    background: rgba(0,0,0,.18);
    border-left:1px solid rgba(255,255,255,.12);
    border-bottom:1px solid rgba(255,255,255,.12);
    transform: rotate(45deg);
  }
  .bubbleTitle{font-weight:1100;color:var(--ice);letter-spacing:.2px}
  .bubbleText{margin-top:4px;color:var(--muted);font-weight:800;font-size:13px;line-height:1.25}

  /* Modals */
  .modal{
    position:fixed; inset:0;
    background: rgba(0,0,0,.65);
    display:none; align-items:center; justify-content:center;
    padding:18px; z-index:60;
    backdrop-filter: blur(6px);
  }
  .modal.show{display:flex}
  .modalCard{
    width:min(980px, 100%);
    background: linear-gradient(180deg, rgba(18,18,74,.96), rgba(13,13,42,.96));
    border:1px solid rgba(255,255,255,.12);
    border-radius:22px;
    box-shadow: 0 0 0 1px rgba(0,229,255,.10), 0 30px 90px rgba(0,0,0,.65);
    overflow:hidden;
  }
  .modalHead{
    padding:14px 16px;
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    border-bottom:1px solid rgba(255,255,255,.10);
    background: linear-gradient(90deg, rgba(255,59,59,.14), rgba(45,255,106,.10), rgba(0,229,255,.12));
  }
  .meta{font-weight:1100;letter-spacing:.4px}
  .pill{
    font-size:12px;font-weight:1100;
    padding:6px 10px;border-radius:999px;
    border:1px solid rgba(255,255,255,.18);
    background: rgba(0,0,0,.18);
    color:var(--muted);
  }
  .body{padding:18px 16px 16px;display:grid;gap:12px}
  .clue{font-size:30px;font-weight:1200;line-height:1.12;text-shadow:0 0 18px rgba(255,43,214,.14), 0 0 18px rgba(0,229,255,.12)}
  .answer{display:none;font-size:22px;font-weight:1100;color: rgba(45,255,106,.96);text-shadow:0 0 18px rgba(45,255,106,.18)}
  .answer.show{display:block}
  .modalActions{
    display:flex;gap:10px;flex-wrap:wrap;
    align-items:center;justify-content:space-between;
    padding:14px 16px 16px;border-top:1px solid rgba(255,255,255,.10);
  }
  .hint{font-size:12px;color:var(--muted);line-height:1.3}
  .judgeRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
  .judgeRow select{min-width:160px}

  /* Setup modal */
  .setupGrid{display:grid;gap:10px}
  .setupRow{display:grid;grid-template-columns: 1fr 1fr; gap:10px}
  @media(max-width:600px){.setupRow{grid-template-columns:1fr}}
  .setupCard{
    padding:12px;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.10);
    background: rgba(0,0,0,.18);
  }

  /* Festive Lane */
  .festiveLane{
    margin-top:12px;
    height:132px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.10);
    background:
      radial-gradient(900px 160px at 20% 30%, rgba(255,59,59,.12), transparent 60%),
      radial-gradient(900px 160px at 75% 40%, rgba(45,255,106,.10), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.12));
    position:relative;
    overflow:hidden;
    box-shadow: 0 0 0 1px rgba(255,255,255,.04);
  }
  .lights{position:absolute; left:0; right:0; top:10px; height:18px; opacity:.85;}
  .bulb{
    position:absolute; top:0;
    width:10px; height:14px; border-radius:999px;
    box-shadow: 0 0 12px rgba(255,255,255,.20);
    animation: twinkle 1.2s ease-in-out infinite;
  }
  .bulb:after{
    content:"";
    position:absolute; left:50%; top:-4px; width:8px; height:6px;
    transform:translateX(-50%);
    border-radius:4px;
    background: rgba(255,255,255,.22);
  }
  @keyframes twinkle{
    0%,100%{filter:brightness(1); transform: translateY(0)}
    50%{filter:brightness(1.8); transform: translateY(1px)}
  }

  .sleighWrap{
    position:absolute; left:-760px; top:44px;
    width:760px; height:84px;
    animation: sleighFly 7.2s linear infinite;
    filter: drop-shadow(0 0 16px rgba(255,210,74,.22));
  }
  @keyframes sleighFly{
    0%{transform: translateX(0) translateY(0) rotate(-1.5deg)}
    45%{transform: translateX(55vw) translateY(-10px) rotate(1.5deg)}
    100%{transform: translateX(170vw) translateY(0) rotate(-1.5deg)}
  }

  .snowmanSvg{
    position:absolute; left:18px; bottom:10px;
    width:88px; height:96px;
    transform-origin: 50% 100%;
    animation: snowBop 1.25s ease-in-out infinite;
    filter: drop-shadow(0 0 12px rgba(191,233,255,.18));
    cursor:pointer;
  }
  @keyframes snowBop{
    0%,100%{transform: rotate(-4deg) translateY(0)}
    50%{transform: rotate(5deg) translateY(-4px)}
  }
  .snowmanSvg.fallen{animation:none; transform: rotate(16deg) translateY(8px);}
  .ornamentSvg{
    position:absolute; right:110px; top:-4px;
    width:64px; height:88px;
    transform-origin: 50% 0%;
    animation: swing 1.6s ease-in-out infinite;
    filter: drop-shadow(0 0 12px rgba(255,43,214,.18));
  }
  @keyframes swing{0%,100%{transform: rotate(-8deg)}50%{transform: rotate(8deg)}}
  .giftSvg{
    position:absolute; right:18px; bottom:12px;
    width:74px; height:74px;
    animation: giftBounce .9s ease-in-out infinite;
    filter: drop-shadow(0 0 14px rgba(0,229,255,.16));
    cursor:pointer;
  }
  @keyframes giftBounce{0%,100%{transform: translateY(0)}50%{transform: translateY(-8px)}}
  .confetti{
    position:absolute; width:7px; height:7px; border-radius:2px;
    pointer-events:none;
    box-shadow: 0 0 8px rgba(255,255,255,.25);
  }

  /* ===== TV MODE (Big screen readability) ===== */
  body.tv .wrap{max-width:1600px}
  body.tv h1{font-size:42px}
  body.tv .sub{font-size:16px}
  body.tv .tile{height:110px; font-size:34px}
  body.tv .cat{font-size:14px; padding:14px 10px}
  body.tv .layout{grid-template-columns: 1fr; }
  body.tv .side{display:none;}          /* hide side panel on TV */
  body.tv .panel{padding:16px;}
  body.tv .clue{font-size:42px}
  body.tv .answer{font-size:30px}
  body.tv .modalCard{width:min(1180px, 96vw)}
  body.tv .hint{font-size:14px}

  /* ===== HOST MODE BAR (TV control overlay) ===== */
  .hostBar{
    position:fixed;
    left:14px; right:14px; bottom:14px;
    z-index:70;
    display:none;
    gap:10px;
    padding:12px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.34);
    backdrop-filter: blur(10px);
    box-shadow: 0 18px 55px rgba(0,0,0,.55);
  }
  body.host .hostBar{display:flex;}
  .hostBar .btn{padding:12px 14px; border-radius:14px;}
  .hostBar .cluster{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
  .hostBar .grow{flex:1}
  .hostBar .stat{
    padding:10px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    font-weight:1000;
    letter-spacing:.2px;
  }
  .hostBar .stat b{color: var(--gold)}
  .hostBar .small{font-size:12px; color:var(--muted); font-weight:900}

  /* ===== AUDIO UNLOCK OVERLAY (for Fire TV browsers) ===== */
  .unlock{
    position:fixed; inset:0; z-index:80;
    display:none; align-items:center; justify-content:center;
    background: rgba(0,0,0,.72);
    backdrop-filter: blur(6px);
    padding:18px;
  }
  .unlock.show{display:flex;}
  .unlockCard{
    width:min(720px, 100%);
    border-radius:22px;
    border:1px solid rgba(255,255,255,.14);
    background: linear-gradient(180deg, rgba(18,18,74,.96), rgba(13,13,42,.96));
    box-shadow: 0 30px 90px rgba(0,0,0,.65);
    padding:18px;
  }
  .unlockCard h2{margin:0 0 8px; font-size:22px}
  .unlockCard p{margin:0 0 14px; color:var(--muted); font-weight:800; line-height:1.35}
  .unlockCard .btn{width:100%; padding:14px; font-size:16px}

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce){
    .flake, .aurora, .sleighWrap, .snowmanSvg, .ornamentSvg, .giftSvg, .bulb, h1::before, h1::after{
      animation: none !important;
    }
  }
</style>
</head>

<body>
  <div class="stars" aria-hidden="true"></div>
  <div class="aurora" aria-hidden="true"></div>
  <div class="snow" id="snow" aria-hidden="true"></div>

  <div class="wrap">
    <header>
      <div class="brand">
        <div class="badge" aria-hidden="true"></div>
        <div class="titleWrap">
          <h1>Claudio’s Christmas Jeopardy</h1>
          <div class="sub">May The Smartest Elf Win</div>
        </div>
      </div>

      <div class="topbar">
        <button class="btn" id="btnSetup">Setup</button>
        <button class="btn ghost" id="btnTV">TV Mode: OFF</button>
        <button class="btn ghost" id="btnHostMode">Host Mode: OFF</button>
        <button class="btn" id="btnLock">Lock Board: OFF</button>
        <button class="btn gold" id="btnFinal">Final Jeopardy</button>
        <button class="btn red" id="btnReset">Reset Game</button>
      </div>
    </header>

    <div class="layout">
      <section class="panel">
        <div class="grid" id="board" aria-label="Jeopardy board"></div>

        <div class="festiveLane" aria-hidden="true" id="lane">
          <div class="lights" id="lights"></div>

          <!-- Sleigh + reindeer: extra detailing (metallic gradients, highlights, harness polish) -->
          <div class="sleighWrap" id="sleighWrap">
            <svg viewBox="0 0 900 140" width="760" height="84" aria-hidden="true">
              <defs>
                <linearGradient id="reinG" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%" stop-color="rgba(255,255,255,.45)"/>
                  <stop offset="100%" stop-color="rgba(255,255,255,.10)"/>
                </linearGradient>
                <linearGradient id="sleighRed" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%" stop-color="#ff3b3b"/>
                  <stop offset="55%" stop-color="#d21b5d"/>
                  <stop offset="100%" stop-color="#860048"/>
                </linearGradient>
                <linearGradient id="goldG" x1="0" y1="0" x2="1" y2="0">
                  <stop offset="0%" stop-color="#ffd24a"/>
                  <stop offset="60%" stop-color="#ffb22b"/>
                  <stop offset="100%" stop-color="#ff8a1a"/>
                </linearGradient>
                <radialGradient id="iceHi" cx="30%" cy="25%" r="70%">
                  <stop offset="0%" stop-color="rgba(255,255,255,.60)"/>
                  <stop offset="100%" stop-color="rgba(191,233,255,.20)"/>
                </radialGradient>
              </defs>

              <!-- harness lines -->
              <path d="M340 80 C430 36, 620 34, 800 72" fill="none" stroke="url(#reinG)" stroke-width="3.2" stroke-linecap="round"/>
              <path d="M340 86 C440 50, 630 48, 800 82" fill="none" stroke="rgba(255,255,255,.18)" stroke-width="3.2" stroke-linecap="round"/>

              <!-- sleigh (behind/left) -->
              <g transform="translate(230,20)">
                <path d="M30 60 C24 36, 40 18, 64 22 C82 6, 118 16, 118 44 C136 50, 138 78, 116 84
                         C100 96, 64 94, 42 84 C32 76, 32 70, 30 60Z"
                      fill="rgba(191,233,255,.38)" stroke="rgba(255,255,255,.16)" stroke-width="2.4"/>
                <path d="M10 82 C26 58, 92 52, 142 60 C168 64, 190 56, 212 38
                         C216 64, 214 90, 200 100 C184 112, 124 114, 88 110 C44 106, 20 96, 10 82Z"
                      fill="url(#sleighRed)" stroke="rgba(255,255,255,.18)" stroke-width="3.2"/>
                <path d="M28 80 C54 60, 120 60, 164 68" fill="none" stroke="rgba(255,255,255,.35)" stroke-width="5" stroke-linecap="round"/>
                <path d="M20 104 C56 122, 150 124, 196 106" fill="none" stroke="url(#goldG)" stroke-width="8" stroke-linecap="round"/>
                <path d="M24 110 C62 126, 146 128, 190 114" fill="none" stroke="rgba(255,210,74,.42)" stroke-width="4" stroke-linecap="round"/>

                <!-- “Santa face” lantern -->
                <circle cx="88" cy="50" r="14" fill="rgba(255,240,200,.92)" stroke="rgba(255,255,255,.12)" stroke-width="2"/>
                <circle cx="84" cy="48" r="2.2" fill="#0b0b14"/>
                <circle cx="94" cy="48" r="2.2" fill="#0b0b14"/>
                <path d="M82 56 C88 62, 92 62, 98 56" stroke="rgba(0,0,0,.35)" stroke-width="3" fill="none" stroke-linecap="round"/>
                <path d="M76 62 C84 72, 92 72, 100 62" fill="none" stroke="rgba(255,255,255,.55)" stroke-width="6" stroke-linecap="round"/>
                <circle cx="88" cy="32" r="10" fill="rgba(255,59,59,.92)"/>
                <circle cx="98" cy="28" r="5.8" fill="rgba(191,233,255,.95)" stroke="rgba(255,255,255,.18)" stroke-width="2"/>

                <!-- highlight sheen -->
                <path d="M34 72 C70 54, 130 54, 178 70" fill="none" stroke="url(#iceHi)" stroke-width="6" stroke-linecap="round" opacity=".55"/>
              </g>

              <!-- reindeer (ahead/right) -->
              <g transform="translate(540,10)">
                <!-- animated bob using CSS on group -->
                <g class="reindeer" transform="translate(0,22)">
                  <ellipse cx="70" cy="48" rx="42" ry="24" fill="rgba(191,233,255,.32)" stroke="rgba(255,255,255,.14)" stroke-width="2"/>
                  <path d="M92 44 C102 18, 136 22, 138 46 C140 72, 108 74, 102 56" fill="rgba(191,233,255,.40)" stroke="rgba(255,255,255,.14)" stroke-width="2"/>
                  <path d="M124 18 L118 6 M128 18 L138 6 M120 12 L112 2" stroke="rgba(255,255,255,.36)" stroke-width="3" stroke-linecap="round"/>
                  <circle cx="128" cy="44" r="2.6" fill="#0b0b14"/>
                  <circle cx="144" cy="54" r="4.6" fill="rgba(255,59,59,.96)"/>
                  <path d="M44 62 L34 88 M62 66 L56 92 M78 66 L76 94 M98 62 L104 88"
                        stroke="rgba(255,255,255,.26)" stroke-width="6" stroke-linecap="round"/>
                  <path d="M38 46 C55 34, 90 34, 112 48" fill="none" stroke="rgba(255,210,74,.78)" stroke-width="3" stroke-linecap="round"/>
                  <path d="M52 52 C62 58, 74 58, 84 52" fill="none" stroke="rgba(0,0,0,.22)" stroke-width="3" stroke-linecap="round"/>
                </g>
                <g class="reindeer" transform="translate(130,34)" opacity=".92">
                  <ellipse cx="70" cy="48" rx="42" ry="24" fill="rgba(191,233,255,.28)" stroke="rgba(255,255,255,.12)" stroke-width="2"/>
                  <path d="M92 44 C102 18, 136 22, 138 46 C140 72, 108 74, 102 56" fill="rgba(191,233,255,.34)" stroke="rgba(255,255,255,.12)" stroke-width="2"/>
                  <path d="M124 18 L118 6 M128 18 L138 6 M120 12 L112 2" stroke="rgba(255,255,255,.30)" stroke-width="3" stroke-linecap="round"/>
                  <circle cx="128" cy="44" r="2.6" fill="#0b0b14"/>
                  <circle cx="144" cy="54" r="4.2" fill="rgba(255,59,59,.90)"/>
                  <path d="M44 62 L34 88 M62 66 L56 92 M78 66 L76 94 M98 62 L104 88"
                        stroke="rgba(255,255,255,.22)" stroke-width="6" stroke-linecap="round"/>
                  <path d="M38 46 C55 34, 90 34, 112 48" fill="none" stroke="rgba(255,210,74,.70)" stroke-width="3" stroke-linecap="round"/>
                </g>
                <g class="reindeer" transform="translate(260,24)" opacity=".86">
                  <ellipse cx="70" cy="48" rx="42" ry="24" fill="rgba(191,233,255,.24)" stroke="rgba(255,255,255,.10)" stroke-width="2"/>
                  <path d="M92 44 C102 18, 136 22, 138 46 C140 72, 108 74, 102 56" fill="rgba(191,233,255,.28)" stroke="rgba(255,255,255,.10)" stroke-width="2"/>
                  <path d="M124 18 L118 6 M128 18 L138 6 M120 12 L112 2" stroke="rgba(255,255,255,.26)" stroke-width="3" stroke-linecap="round"/>
                  <circle cx="128" cy="44" r="2.6" fill="#0b0b14"/>
                  <circle cx="144" cy="54" r="4.0" fill="rgba(255,59,59,.86)"/>
                  <path d="M44 62 L34 88 M62 66 L56 92 M78 66 L76 94 M98 62 L104 88"
                        stroke="rgba(255,255,255,.20)" stroke-width="6" stroke-linecap="round"/>
                  <path d="M38 46 C55 34, 90 34, 112 48" fill="none" stroke="rgba(255,210,74,.62)" stroke-width="3" stroke-linecap="round"/>
                </g>
              </g>
            </svg>
          </div>

          <!-- Snowman -->
          <svg class="snowmanSvg" id="snowman" viewBox="0 0 100 110" aria-hidden="true">
            <defs>
              <radialGradient id="snowGlow" cx="30%" cy="20%" r="70%">
                <stop offset="0%" stop-color="rgba(255,255,255,.95)"/>
                <stop offset="100%" stop-color="rgba(191,233,255,.75)"/>
              </radialGradient>
            </defs>
            <circle cx="50" cy="78" r="26" fill="url(#snowGlow)" stroke="rgba(255,255,255,.18)" stroke-width="3"/>
            <circle cx="50" cy="48" r="20" fill="url(#snowGlow)" stroke="rgba(255,255,255,.18)" stroke-width="3"/>
            <path d="M30 56 C40 64, 60 64, 70 56" stroke="rgba(255,59,59,.90)" stroke-width="8" stroke-linecap="round" fill="none"/>
            <path d="M60 58 C66 64, 66 76, 56 80" stroke="rgba(255,59,59,.85)" stroke-width="8" stroke-linecap="round" fill="none"/>
            <circle cx="42" cy="44" r="2.8" fill="#0b0b14"/>
            <circle cx="58" cy="44" r="2.8" fill="#0b0b14"/>
            <path d="M50 48 L74 54 L50 58 Z" fill="rgba(255,210,74,.95)" stroke="rgba(0,0,0,.18)" stroke-width="2"/>
            <path d="M40 56 C46 60, 54 60, 60 56" stroke="rgba(0,0,0,.30)" stroke-width="3" fill="none" stroke-linecap="round"/>
            <circle cx="50" cy="72" r="3" fill="rgba(0,0,0,.35)"/>
            <circle cx="50" cy="84" r="3" fill="rgba(0,0,0,.35)"/>
            <circle cx="50" cy="96" r="3" fill="rgba(0,0,0,.35)"/>
            <path d="M26 70 C14 66, 10 56, 18 50" stroke="rgba(90,60,30,.70)" stroke-width="5" stroke-linecap="round" fill="none"/>
            <path d="M74 70 C86 66, 90 56, 82 50" stroke="rgba(90,60,30,.70)" stroke-width="5" stroke-linecap="round" fill="none"/>
            <rect x="34" y="18" width="32" height="18" rx="6" fill="rgba(0,0,0,.55)"/>
            <rect x="28" y="32" width="44" height="8" rx="6" fill="rgba(0,0,0,.55)"/>
            <rect x="30" y="30" width="40" height="4" rx="4" fill="rgba(255,43,214,.55)"/>
          </svg>

          <!-- Ornament -->
          <svg class="ornamentSvg" viewBox="0 0 90 125" aria-hidden="true">
            <defs>
              <radialGradient id="ornHi" cx="30%" cy="25%" r="70%">
                <stop offset="0%" stop-color="rgba(255,255,255,.60)"/>
                <stop offset="55%" stop-color="rgba(255,43,214,.85)"/>
                <stop offset="100%" stop-color="rgba(70,0,120,.95)"/>
              </radialGradient>
              <linearGradient id="capG" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="rgba(255,210,74,.95)"/>
                <stop offset="100%" stop-color="rgba(255,159,43,.85)"/>
              </linearGradient>
            </defs>

            <path d="M45 2 L45 28" stroke="rgba(255,255,255,.30)" stroke-width="3" stroke-linecap="round"/>
            <path d="M33 28 C35 18, 55 18, 57 28" fill="url(#capG)" stroke="rgba(255,255,255,.18)" stroke-width="2"/>
            <rect x="30" y="28" width="30" height="16" rx="6" fill="url(#capG)" stroke="rgba(255,255,255,.18)" stroke-width="2"/>

            <circle cx="45" cy="82" r="34" fill="url(#ornHi)" stroke="rgba(255,255,255,.20)" stroke-width="3"/>
            <path d="M28 74 C35 58, 55 58, 62 74" stroke="rgba(255,255,255,.22)" stroke-width="5" fill="none" stroke-linecap="round"/>
            <path d="M24 92 C36 104, 54 104, 66 92" stroke="rgba(0,229,255,.22)" stroke-width="5" fill="none" stroke-linecap="round"/>
            <circle cx="60" cy="88" r="5" fill="rgba(255,210,74,.80)"/>
          </svg>

          <!-- Gift -->
          <svg class="giftSvg" id="gift" viewBox="0 0 120 120" aria-hidden="true">
            <defs>
              <linearGradient id="boxG" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0%" stop-color="rgba(45,255,106,.95)"/>
                <stop offset="100%" stop-color="rgba(0,229,255,.55)"/>
              </linearGradient>
              <linearGradient id="ribG" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="rgba(255,59,59,.95)"/>
                <stop offset="100%" stop-color="rgba(255,43,214,.65)"/>
              </linearGradient>
              <radialGradient id="shine" cx="30%" cy="25%" r="70%">
                <stop offset="0%" stop-color="rgba(255,255,255,.35)"/>
                <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
              </radialGradient>
            </defs>

            <rect x="22" y="46" width="76" height="60" rx="16" fill="url(#boxG)" stroke="rgba(255,255,255,.18)" stroke-width="3"/>
            <rect x="20" y="38" width="80" height="18" rx="12" fill="rgba(255,255,255,.10)" stroke="rgba(255,255,255,.14)" stroke-width="2"/>

            <rect x="56" y="38" width="8" height="68" rx="7" fill="url(#ribG)"/>
            <rect x="22" y="72" width="76" height="9" rx="8" fill="url(#ribG)"/>

            <path d="M60 38 C48 34, 44 26, 52 24 C60 22, 62 30, 60 38Z" fill="rgba(255,210,74,.92)" stroke="rgba(0,0,0,.14)" stroke-width="2"/>
            <path d="M60 38 C72 34, 76 26, 68 24 C60 22, 58 30, 60 38Z" fill="rgba(255,210,74,.92)" stroke="rgba(0,0,0,.14)" stroke-width="2"/>

            <ellipse cx="46" cy="70" rx="26" ry="20" fill="url(#shine)"/>
          </svg>
        </div>

        <div class="hint" style="margin-top:12px;">
          Remote tips: use D-pad to move tiles; press <b>Select/Enter</b> to open. Press <b>Back/Esc</b> to close.
        </div>
      </section>

      <aside class="side">
        <section class="panel">
          <div class="sectionTitle">
            <span>Host</span>
            <span class="mini">Elf MC</span>
          </div>

          <div class="hostRow">
            <div class="hostStage">
              <svg class="host" id="host" viewBox="0 0 140 140" aria-label="Animated elf host" data-mood="happy">
                <defs>
                  <radialGradient id="faceG" cx="30%" cy="25%" r="80%">
                    <stop offset="0%" stop-color="rgba(255,240,200,.96)"/>
                    <stop offset="100%" stop-color="rgba(255,200,120,.90)"/>
                  </radialGradient>
                  <linearGradient id="hatG" x1="0" y1="0" x2="1" y2="1">
                    <stop offset="0%" stop-color="rgba(255,59,59,.96)"/>
                    <stop offset="100%" stop-color="rgba(255,43,214,.55)"/>
                  </linearGradient>
                </defs>

                <path d="M28 78 C10 70, 12 96, 30 90 Z" fill="url(#faceG)" stroke="rgba(255,255,255,.18)" stroke-width="2"/>
                <path d="M112 78 C130 70, 128 96, 110 90 Z" fill="url(#faceG)" stroke="rgba(255,255,255,.18)" stroke-width="2"/>

                <g id="hat" transform="translate(0,0)">
                  <path d="M40 58 C50 18, 96 18, 104 60 C90 54, 56 54, 40 58Z"
                        fill="url(#hatG)" stroke="rgba(255,255,255,.18)" stroke-width="2"/>
                  <path d="M38 60 C54 48, 90 48, 106 62" fill="none" stroke="rgba(255,255,255,.35)" stroke-width="4" stroke-linecap="round"/>
                  <circle cx="112" cy="48" r="10" fill="rgba(191,233,255,.95)" stroke="rgba(255,255,255,.22)" stroke-width="2"/>
                </g>

                <path d="M42 78 C48 62, 60 58, 70 62 C80 58, 92 62, 98 78
                         C90 74, 82 74, 70 80 C58 74, 50 74, 42 78Z"
                      fill="rgba(90,60,30,.80)"/>

                <circle cx="70" cy="84" r="34" fill="url(#faceG)" stroke="rgba(255,255,255,.16)" stroke-width="2"/>

                <circle cx="50" cy="90" r="8" fill="rgba(255,59,59,.16)"/>
                <circle cx="90" cy="90" r="8" fill="rgba(255,59,59,.16)"/>

                <g id="eyes">
                  <ellipse cx="58" cy="80" rx="5" ry="7" fill="#0b0b14"/>
                  <ellipse cx="82" cy="80" rx="5" ry="7" fill="#0b0b14"/>
                  <circle cx="56" cy="78" r="1.6" fill="rgba(255,255,255,.65)"/>
                  <circle cx="80" cy="78" r="1.6" fill="rgba(255,255,255,.65)"/>
                  <rect class="lid" x="51" y="72" width="14" height="16" fill="url(#faceG)" style="opacity:0"/>
                  <rect class="lid" x="75" y="72" width="14" height="16" fill="url(#faceG)" style="opacity:0"/>
                </g>

                <path d="M52 70 C56 66, 60 66, 64 70" stroke="rgba(0,0,0,.45)" stroke-width="4" fill="none" stroke-linecap="round"/>
                <path d="M76 70 C80 66, 84 66, 88 70" stroke="rgba(0,0,0,.45)" stroke-width="4" fill="none" stroke-linecap="round"/>

                <path d="M68 86 C70 88, 72 88, 74 86" stroke="rgba(0,0,0,.35)" stroke-width="4" fill="none" stroke-linecap="round"/>

                <path id="mouth" d="M56 100 C64 110, 76 110, 84 100" fill="none" stroke="#0b0b14" stroke-width="5" stroke-linecap="round"/>

                <path d="M50 122 L70 136 L90 122" fill="none" stroke="rgba(45,255,106,.85)" stroke-width="6" stroke-linecap="round"/>
                <circle cx="70" cy="134" r="5" fill="rgba(255,210,74,.95)"/>
              </svg>
            </div>

            <div class="bubble">
              <div class="bubbleTitle" id="hostTitle">Welcome!</div>
              <div class="bubbleText" id="hostText">Pick a category and let’s jingle these points!</div>
            </div>
          </div>
        </section>

        <section class="panel">
          <div class="sectionTitle">
            <span>Timer</span>
            <span class="mini">Resets per clue</span>
          </div>

          <div class="timerBox">
            <div class="time" id="time">0:20</div>
            <div class="timerBtns">
              <button class="btn green" id="timerStart">Start</button>
              <button class="btn" id="timerPause">Pause</button>
              <button class="btn red" id="timerReset">Reset</button>
            </div>
          </div>

          <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;">
            <span class="hint">Timer-only music can follow the clock.</span>
            <div style="display:flex; gap:8px; align-items:center;">
              <span class="mini">Seconds:</span>
              <input id="timerSeconds" type="number" min="5" max="120" value="20" />
            </div>
          </div>
        </section>

        <section class="panel">
          <div class="sectionTitle">
            <span>Buzzer</span>
            <span class="mini">Spacebar</span>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn" id="btnBuzz">BUZZ</button>
            <button class="btn red" id="btnTimeUp">Time’s Up</button>
          </div>
          <div class="hint" style="margin-top:10px;">
            If audio is blocked, click “Enable Sound” once.
          </div>
        </section>

        <section class="panel">
          <div class="sectionTitle">
            <span>Background Music</span>
            <span class="mini">Original loop</span>
          </div>

          <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
            <button class="btn green" id="musicPlay">Play</button>
            <button class="btn red" id="musicStop">Stop</button>

            <span class="mini">Vol</span>
            <input id="musicVol" type="number" min="0" max="100" value="25" style="width:90px" />
          </div>

          <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;">
            <label class="mini" style="display:flex; gap:8px; align-items:center;">
              <input type="checkbox" id="timerMusicOnly" />
              Timer-only “thinking” music
            </label>
            <span class="hint">When ON: music plays only while timer runs.</span>
          </div>
        </section>

        <section class="panel">
          <div class="sectionTitle">
            <span>Scoreboard</span>
            <span class="mini">2–6 teams</span>
          </div>

          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:space-between; margin-bottom:10px;">
            <span class="mini">Teams:</span>
            <select id="teamCount">
              <option>2</option><option selected>3</option><option>4</option><option>5</option><option>6</option>
            </select>
          </div>

          <div class="teams" id="teams"></div>
          <div class="hint" style="margin-top:10px;">
            +Clue/-Clue uses current clue (or DD wager / Final wager).
          </div>
        </section>
      </aside>
    </div>
  </div>

  <!-- HOST MODE BAR (TV overlay controls) -->
  <div class="hostBar" id="hostBar" aria-label="Host controls">
    <div class="cluster grow">
      <div class="stat"><span class="small">Timer</span> <b id="barTime">0:20</b></div>
      <button class="btn green" id="barStart">Start</button>
      <button class="btn" id="barPause">Pause</button>
      <button class="btn red" id="barReset">Reset</button>
      <button class="btn" id="barBuzz">Buzz</button>
      <button class="btn red" id="barTimeUp">Time’s Up</button>
    </div>
    <div class="cluster">
      <button class="btn" id="barReveal">Reveal</button>
      <button class="btn red" id="barClose">Close</button>
    </div>
  </div>

  <!-- AUDIO UNLOCK OVERLAY -->
  <div class="unlock" id="unlock">
    <div class="unlockCard">
      <h2>Enable Sound</h2>
      <p>
        Some TV browsers block audio until you click once.
        Hit the button below to enable buzzers + music.
      </p>
      <button class="btn green" id="unlockBtn">Enable Sound</button>
      <div class="hint" style="margin-top:10px;">You can still play silently if you prefer.</div>
    </div>
  </div>

  <!-- Setup Modal -->
  <div class="modal" id="setupModal" role="dialog" aria-modal="true" aria-label="Setup">
    <div class="modalCard">
      <div class="modalHead">
        <div class="meta">Game Setup</div>
        <div class="pill">Names • Teams • Start</div>
      </div>
      <div class="body">
        <div class="setupGrid">
          <div class="setupRow">
            <div class="setupCard">
              <div class="mini" style="margin-bottom:8px;">Number of Teams</div>
              <select id="setupTeamCount">
                <option>2</option><option selected>3</option><option>4</option><option>5</option><option>6</option>
              </select>
              <div class="hint" style="margin-top:8px;">You can still change this later on the scoreboard.</div>
            </div>
            <div class="setupCard">
              <div class="mini" style="margin-bottom:8px;">Shuffle on Start</div>
              <label class="mini" style="display:flex; gap:8px; align-items:center;">
                <input type="checkbox" id="setupShuffle" checked />
                Shuffle categories + clues now
              </label>
              <div class="hint" style="margin-top:8px;">Reset Game also shuffles automatically.</div>
            </div>
          </div>

          <div class="setupCard">
            <div class="mini" style="margin-bottom:8px;">Team Names</div>
            <div id="setupNames" class="setupGrid"></div>
          </div>
        </div>
      </div>
      <div class="modalActions">
        <div class="hint">Tip: On Fire TV, click “Enable Sound” once if buzz/music is silent.</div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <button class="btn" id="setupClose">Close</button>
          <button class="btn green" id="setupStart">Start Game</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Clue Modal -->
  <div class="modal" id="clueModal" role="dialog" aria-modal="true" aria-label="Clue">
    <div class="modalCard">
      <div class="modalHead">
        <div class="meta" id="clueMeta">Category • $100</div>
        <div class="pill" id="cluePill">Clue</div>
      </div>
      <div class="body">
        <div class="clue" id="clueText"></div>
        <div class="answer" id="answerText"></div>

        <div class="panel" style="padding:12px; background: rgba(0,0,0,.18); border:1px solid rgba(255,255,255,.10);">
          <div class="sectionTitle" style="margin:0 0 10px;">
            <span>Judge</span>
            <span class="mini">Apply points fast</span>
          </div>
          <div class="judgeRow">
            <select id="judgeTeam"></select>
            <button class="btn green" id="judgeCorrect">Correct +</button>
            <button class="btn red" id="judgeWrong">Wrong −</button>
          </div>
          <div class="hint" style="margin-top:8px;">
            Uses clue value (or Daily Double wager if set). Closes clue automatically.
          </div>
        </div>
      </div>

      <div class="modalActions">
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
          <button class="btn" id="btnReveal">Reveal Answer</button>
          <button class="btn gold" id="btnWager" style="display:none;">Daily Double Wager</button>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
          <span class="hint">Back/Esc closes.</span>
          <button class="btn red" id="btnClose">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Final Jeopardy Modal -->
  <div class="modal" id="finalModal" role="dialog" aria-modal="true" aria-label="Final Jeopardy">
    <div class="modalCard">
      <div class="modalHead">
        <div class="meta">Final Jeopardy</div>
        <div class="pill">Wagers • Reveal • Judge</div>
      </div>
      <div class="body">
        <div class="meta" id="finalCategory" style="color: var(--gold); font-size:16px;">FINAL CATEGORY</div>
        <div class="clue" id="finalClue" style="font-size:28px;">Final clue…</div>
        <div class="answer" id="finalAnswer">Final answer…</div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:8px;">
          <button class="btn gold" id="finalWager">Enter Team Wagers</button>
          <button class="btn" id="finalReveal">Reveal Answer</button>
          <button class="btn red" id="finalClose">Close</button>
        </div>

        <div class="panel" style="padding:12px; background: rgba(0,0,0,.18); border:1px solid rgba(255,255,255,.10);">
          <div class="sectionTitle" style="margin:0 0 10px;">
            <span>Final Judge</span>
            <span class="mini">Uses wager</span>
          </div>
          <div class="judgeRow">
            <select id="finalJudgeTeam"></select>
            <button class="btn green" id="finalCorrect">Correct +</button>
            <button class="btn red" id="finalWrong">Wrong −</button>
          </div>
          <div class="hint" style="margin-top:8px;">
            Applies each team’s saved wager. (Enter wagers first.)
          </div>
        </div>

        <div class="hint">
          Flow: enter wagers → read clue → reveal → mark correct/wrong for each team.
        </div>
      </div>
    </div>
  </div>

<script>
/** =========================
 *  DATA
 *  ========================= */
const BASE_GAME_DATA = {
  categories: [
    { name:"O Christmas Tree", clues:[
      { value:100, q:"This is the traditional type of Christmas tree most people bring inside.", a:"What is an evergreen?" },
      { value:200, q:"A popular decoration placed at the very top of the tree.", a:"What is a star (or angel)?" },
      { value:300, q:"These are often wrapped around the tree to make it sparkle.", a:"What are lights?" },
      { value:400, q:"The thin, shiny strands people drape on a tree for sparkle.", a:"What is tinsel?" },
      { value:500, q:"The part of the tree you add water to so it stays fresh.", a:"What is a tree stand?" },
    ]},
    { name:"The Grinch Who Stole Christmas", clues:[
      { value:100, q:"The Grinch lives on this mountain above Whoville.", a:"What is Mount Crumpit?" },
      { value:200, q:"The Grinch’s dog (his reluctant helper) is named…", a:"Who is Max?" },
      { value:300, q:"The Grinch disguises himself as this to steal presents.", a:"Who is Santa Claus?" },
      { value:400, q:"This little Who shows kindness to the Grinch.", a:"Who is Cindy Lou Who?" },
      { value:500, q:"The Grinch’s heart grows to this many sizes.", a:"What is three sizes?" },
    ]},
    { name:"Santa Claus is Coming to Town", clues:[
      { value:100, q:"Santa travels in a vehicle pulled by reindeer called a…", a:"What is a sleigh?" },
      { value:200, q:"Kids often leave these out for Santa on Christmas Eve.", a:"What are cookies (and milk)?" },
      { value:300, q:"Santa keeps track of who’s been good or bad on this.", a:"What is the Naughty/Nice list?" },
      { value:400, q:"The famous warning: ‘You better watch out, you better not…’", a:"What is cry?" },
      { value:500, q:"This is where Santa is traditionally said to live/work.", a:"What is the North Pole?" },
    ]},
    { name:"Christmas Songs", clues:[
      { value:100, q:"‘Jingle Bells’ was originally written for this season.", a:"What is Thanksgiving?" },
      { value:200, q:"‘Feliz Navidad’ means this in English.", a:"What is ‘Merry Christmas’?" },
      { value:300, q:"Song: ‘Oh what fun it is to ride in a one-horse open…’", a:"What is sleigh?" },
      { value:400, q:"‘Silent Night’ was first performed in this country.", a:"What is Austria?" },
      { value:500, q:"‘All I Want for Christmas Is You’ is sung by this artist.", a:"Who is Mariah Carey?" },
    ]},
    { name:"Rudolph the Red-Nosed Reindeer", clues:[
      { value:100, q:"Rudolph is famous for having this.", a:"What is a red nose?" },
      { value:200, q:"Rudolph helps Santa do this on a foggy Christmas Eve.", a:"What is guide the sleigh?" },
      { value:300, q:"Rudolph is a type of this animal.", a:"What is a reindeer?" },
      { value:400, q:"The misfit toys live on this place.", a:"What is the Island of Misfit Toys?" },
      { value:500, q:"In the classic song, Rudolph is mocked because of his…", a:"What is a shiny/red nose?" },
    ]},
    { name:"Things that are Red", clues:[
      { value:100, q:"A classic holiday candy that’s often red-and-white striped.", a:"What is a candy cane?" },
      { value:200, q:"Santa’s most famous clothing color.", a:"What is red?" },
      { value:300, q:"This holiday plant has bright red leaves.", a:"What is poinsettia?" },
      { value:400, q:"Rudolph’s nose color.", a:"What is red?" },
      { value:500, q:"A red fruit often used in holiday desserts and sauces.", a:"What are cranberries?" },
    ]},
  ],
  final: {
    category: "Christmas Songs",
    clue: "This song includes the lyric: ‘A partridge in a pear tree.’",
    answer: "What is The Twelve Days of Christmas?"
  }
};

let gameData = structuredClone(BASE_GAME_DATA);

/** =========================
 *  STATE
 *  ========================= */
const state = {
  used: new Set(),
  current: null,
  locked: false,
  teams: Array.from({length: 3}, (_,i)=>({ name:`Team ${i+1}`, score:0, wager:0 })),
  timer: { seconds: 20, remaining: 20, running:false, interval:null },
  music: { mode: "always" },
  dailyDoubleSet: new Set(),
  dailyDoubleCount: 2,

  tvMode: false,
  hostMode: false,
};

/** =========================
 *  ELEMENTS
 *  ========================= */
const boardEl = document.getElementById("board");
const teamsEl = document.getElementById("teams");
const teamCountEl = document.getElementById("teamCount");

const hostEl = document.getElementById("host");
const mouthEl = document.getElementById("mouth");
const hatEl = document.getElementById("hat");

const hostTitle = document.getElementById("hostTitle");
const hostText = document.getElementById("hostText");

const clueModal = document.getElementById("clueModal");
const clueMeta = document.getElementById("clueMeta");
const cluePill = document.getElementById("cluePill");
const clueText = document.getElementById("clueText");
const answerText = document.getElementById("answerText");
const btnWager = document.getElementById("btnWager");

const judgeTeam = document.getElementById("judgeTeam");
const judgeCorrect = document.getElementById("judgeCorrect");
const judgeWrong = document.getElementById("judgeWrong");

const finalModal = document.getElementById("finalModal");
const finalCategory = document.getElementById("finalCategory");
const finalClue = document.getElementById("finalClue");
const finalAnswer = document.getElementById("finalAnswer");

const finalJudgeTeam = document.getElementById("finalJudgeTeam");
const finalCorrect = document.getElementById("finalCorrect");
const finalWrong = document.getElementById("finalWrong");

const timeEl = document.getElementById("time");
const timerSeconds = document.getElementById("timerSeconds");

const btnBuzz = document.getElementById("btnBuzz");
const btnTimeUp = document.getElementById("btnTimeUp");
const btnReset = document.getElementById("btnReset");
const btnFinal = document.getElementById("btnFinal");
const btnLock = document.getElementById("btnLock");

const finalWagerBtn = document.getElementById("finalWager");
const finalRevealBtn = document.getElementById("finalReveal");
const finalCloseBtn = document.getElementById("finalClose");

const musicPlayBtn = document.getElementById("musicPlay");
const musicStopBtn = document.getElementById("musicStop");
const musicVolEl = document.getElementById("musicVol");
const timerMusicOnlyEl = document.getElementById("timerMusicOnly");

const sleighWrapEl = document.getElementById("sleighWrap");
const snowmanEl = document.getElementById("snowman");
const giftEl = document.getElementById("gift");
const laneEl = document.getElementById("lane");
const lightsEl = document.getElementById("lights");

/* setup modal */
const setupModal = document.getElementById("setupModal");
const btnSetup = document.getElementById("btnSetup");
const setupTeamCount = document.getElementById("setupTeamCount");
const setupShuffle = document.getElementById("setupShuffle");
const setupNames = document.getElementById("setupNames");
const setupClose = document.getElementById("setupClose");
const setupStart = document.getElementById("setupStart");

/* TV + Host toggles */
const btnTV = document.getElementById("btnTV");
const btnHostMode = document.getElementById("btnHostMode");
const barTime = document.getElementById("barTime");
const barStart = document.getElementById("barStart");
const barPause = document.getElementById("barPause");
const barReset = document.getElementById("barReset");
const barBuzz = document.getElementById("barBuzz");
const barTimeUp = document.getElementById("barTimeUp");
const barReveal = document.getElementById("barReveal");
const barClose = document.getElementById("barClose");

/* audio unlock overlay */
const unlock = document.getElementById("unlock");
const unlockBtn = document.getElementById("unlockBtn");

/** =========================
 *  Snowflake SVG generator (more detailed)
 *  ========================= */
function snowflakeSVG(){
  return `
  <svg viewBox="0 0 64 64" aria-hidden="true">
    <g fill="none" stroke="rgba(191,233,255,.94)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M32 5v54"/>
      <path d="M8 18l48 28"/>
      <path d="M56 18L8 46"/>
      <path d="M32 14l-5 5M32 14l5 5"/>
      <path d="M32 50l-5-5M32 50l5-5"/>
      <path d="M16 24l7 0M16 24l4-6"/>
      <path d="M48 40l-7 0M48 40l-4 6"/>
      <path d="M48 24l-7 0M48 24l-4-6"/>
      <path d="M16 40l7 0M16 40l4 6"/>
      <circle cx="32" cy="32" r="3"/>
      <path d="M32 22l-3 3M32 22l3 3"/>
      <path d="M32 42l-3-3M32 42l3-3"/>
    </g>
  </svg>`;
}
(function makeSnow(){
  const snow = document.getElementById("snow");
  snow.innerHTML = "";
  const lowPower = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  const count = lowPower ? 18 : 42;
  for(let i=0;i<count;i++){
    const f = document.createElement("div");
    f.className = "flake";
    f.innerHTML = snowflakeSVG();

    const left = Math.random()*100;
    const size = 10 + Math.random()*14;
    const dur = 9 + Math.random()*12;
    const delay = Math.random()*-dur;
    const drift = (Math.random()*2-1) * 140;
    const rotStart = (Math.random()*360);
    const rotEnd = (120 + Math.random()*360) * (Math.random() < 0.5 ? -1 : 1);

    f.style.left = left + "vw";
    f.style.width = size + "px";
    f.style.height = size + "px";
    f.style.animationDuration = dur + "s";
    f.style.animationDelay = delay + "s";
    f.style.setProperty("--drift", drift + "px");
    f.style.setProperty("--rotEnd", rotEnd + "deg");
    f.style.transform = `rotate(${rotStart}deg)`;
    f.style.opacity = 0.35 + Math.random()*0.55;

    const blur = Math.random() < 0.30 ? (0.6 + Math.random()*0.9) : 0;
    f.style.filter = `drop-shadow(0 0 10px rgba(191,233,255,.12)) blur(${blur}px)`;

    snow.appendChild(f);
  }
})();

/** =========================
 *  LIGHTS
 *  ========================= */
(function makeLights(){
  const colors = ["#ff3b3b","#2dff6a","#00e5ff","#ffd24a","#ff2bd6"];
  const count = 26;
  for(let i=0;i<count;i++){
    const b = document.createElement("div");
    b.className = "bulb";
    b.style.left = (i*(100/(count-1))) + "%";
    b.style.background = colors[i % colors.length];
    b.style.animationDelay = (Math.random()*0.8) + "s";
    lightsEl.appendChild(b);
  }
})();

/** =========================
 *  HOST SPEECH + MOODS
 *  ========================= */
const MOUTHS = {
  happy: "M56 100 C64 110, 76 110, 84 100",
  wow:   "M62 102 C64 92, 76 92, 78 102 C76 112, 64 112, 62 102",
  oops:  "M56 108 C64 98, 76 98, 84 108",
  sassy: "M56 104 C64 100, 76 100, 84 104",
  time:  "M62 108 L78 108"
};
let moodTimer = null;
function hostMood(mood){
  hostEl.dataset.mood = mood;
  mouthEl.setAttribute("d", MOUTHS[mood] || MOUTHS.happy);
  if(mood === "time"){
    hatEl.animate([{transform:"rotate(0deg)"},{transform:"rotate(-10deg)"},{transform:"rotate(0deg)"}],
      {duration:500, iterations:2, easing:"ease-in-out"});
  }
}
function hostSay(title, text, mood="happy", hold=2200){
  hostTitle.textContent = title;
  hostText.textContent = text;
  hostMood(mood);
  if(moodTimer) clearTimeout(moodTimer);
  moodTimer = setTimeout(()=>hostMood("happy"), hold);
}
(function blinkLoop(){
  const lids = hostEl.querySelectorAll(".lid");
  const blinkOnce = () => {
    lids.forEach(l=>l.style.opacity="1");
    setTimeout(()=>lids.forEach(l=>l.style.opacity="0"), 130);
  };
  const run = () => {
    blinkOnce();
    setTimeout(run, 2200 + Math.random()*2500);
  };
  run();
})();

/** =========================
 *  AUDIO (WebAudio)
 *  ========================= */
let audioCtx = null;
function getAudio(){
  if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}
async function ensureAudio(){
  try{
    const ctx = getAudio();
    if(ctx.state === "suspended") await ctx.resume();
    unlock.classList.remove("show");
  }catch{
    // ignore
  }
}
unlockBtn.addEventListener("click", ensureAudio);

/* show unlock overlay on TV browsers more often */
window.addEventListener("load", ()=>{
  // Fire TV/Silk frequently starts suspended; show overlay upfront (user can dismiss by enabling sound)
  unlock.classList.add("show");
});
unlock.addEventListener("click",(e)=>{ if(e.target === unlock) unlock.classList.remove("show"); });

function oneShotTone({type="sine", freq=440, dur=0.2, gain=0.2, glide=null}){
  const ctx = getAudio();
  const o = ctx.createOscillator();
  const g = ctx.createGain();
  o.type = type;
  o.frequency.setValueAtTime(freq, ctx.currentTime);
  if(glide) o.frequency.exponentialRampToValueAtTime(glide, ctx.currentTime + Math.min(dur, 0.2));
  g.gain.setValueAtTime(0.0001, ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(gain, ctx.currentTime + 0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + dur);
  o.connect(g); g.connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime + dur + 0.02);
}
function beep(type="buzz"){
  ensureAudio();
  if(type === "buzz"){
    oneShotTone({type:"sawtooth", freq:220, glide:140, dur:0.26, gain:0.30});
  } else if(type === "timeup"){
    oneShotTone({type:"square", freq:880, dur:0.12, gain:0.22});
    setTimeout(()=>oneShotTone({type:"square", freq:660, dur:0.12, gain:0.18}), 120);
    setTimeout(()=>oneShotTone({type:"square", freq:440, dur:0.18, gain:0.16}), 240);
  } else if(type === "cheer"){
    oneShotTone({type:"triangle", freq:523.25, dur:0.12, gain:0.18});
    setTimeout(()=>oneShotTone({type:"triangle", freq:659.25, dur:0.12, gain:0.18}), 110);
    setTimeout(()=>oneShotTone({type:"triangle", freq:783.99, dur:0.16, gain:0.18}), 220);
  } else if(type === "boo"){
    oneShotTone({type:"sawtooth", freq:220, dur:0.18, gain:0.18});
    setTimeout(()=>oneShotTone({type:"sawtooth", freq:185, dur:0.18, gain:0.18}), 140);
  }
}

/** =========================
 *  MUSIC LOOPS (offline)
 *  ========================= */
let music = { on:false, gain:null, timer:null, step:0 };
let thinking = { on:false, gain:null, timer:null, step:0 };

function musicVolume(){
  return Math.max(0, Math.min(100, Number(musicVolEl?.value ?? 25))) / 100;
}
function stopLoop(obj){
  obj.on = false;
  if(obj.timer){ clearTimeout(obj.timer); obj.timer = null; }
  if(obj.gain){ try{ obj.gain.disconnect(); } catch{} obj.gain = null; }
}
function startMusicLoop(){
  ensureAudio();
  const ctx = getAudio();
  stopLoop(music);
  music.on = true;
  music.step = 0;
  music.gain = ctx.createGain();
  music.gain.gain.value = musicVolume() * 0.33;
  music.gain.connect(ctx.destination);

  const tempo = 156;
  const stepMs = (60_000 / tempo) / 2;
  const base = 220;
  const pattern = [0,7,10,7,12,7,10,7, 0,7,14,7,12,7,10,7];

  const tick = () => {
    if(!music.on) return;
    const now = ctx.currentTime;
    const semis = pattern[music.step % pattern.length];

    { // lead
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = "triangle";
      o.frequency.value = base * Math.pow(2, semis/12);
      o.connect(g); g.connect(music.gain);
      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(0.13, now + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, now + 0.18);
      o.start(now); o.stop(now + 0.19);
    }
    if(music.step % 2 === 0){ // bass pulse
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = "sine";
      o.frequency.value = 110;
      o.connect(g); g.connect(music.gain);
      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(0.07, now + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, now + 0.22);
      o.start(now); o.stop(now + 0.23);
    }

    music.step++;
    music.timer = setTimeout(tick, stepMs);
  };
  tick();
}
function startThinkingLoop(){
  ensureAudio();
  const ctx = getAudio();
  stopLoop(thinking);
  thinking.on = true;
  thinking.step = 0;
  thinking.gain = ctx.createGain();
  thinking.gain.gain.value = musicVolume() * 0.22;
  thinking.gain.connect(ctx.destination);

  const tempo = 120;
  const stepMs = (60_000 / tempo) / 2;
  const base = 196;
  const pattern = [0, 3, 7, 10, 7, 3, 0, 3];

  const tick = () => {
    if(!thinking.on) return;
    const now = ctx.currentTime;
    const semis = pattern[thinking.step % pattern.length];

    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = "sine";
    o.frequency.value = base * Math.pow(2, semis/12);
    o.connect(g); g.connect(thinking.gain);

    g.gain.setValueAtTime(0.0001, now);
    g.gain.exponentialRampToValueAtTime(0.10, now + 0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, now + 0.16);

    o.start(now); o.stop(now + 0.17);

    thinking.step++;
    thinking.timer = setTimeout(tick, stepMs);
  };
  tick();
}
function stopAllMusic(){ stopLoop(music); stopLoop(thinking); }
function updateMusicVolume(){
  const v = musicVolume();
  if(music.gain) music.gain.gain.value = v * 0.33;
  if(thinking.gain) thinking.gain.gain.value = v * 0.22;
}
function setMusicMode(){
  state.music.mode = timerMusicOnlyEl.checked ? "timer" : "always";
  if(state.music.mode === "timer"){
    stopLoop(music);
    hostSay("Music Mode", "Timer-only thinking music is ON.", "happy", 1800);
  } else {
    stopLoop(thinking);
    hostSay("Music Mode", "Always-on background music mode.", "happy", 1800);
  }
}

/** =========================
 *  SHUFFLE HELPERS
 *  ========================= */
function shuffleInPlace(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}
function buildShuffledGame(){
  const fresh = structuredClone(BASE_GAME_DATA);

  // shuffle clues inside each category but keep values aligned
  fresh.categories.forEach(cat=>{
    const values = cat.clues.map(c=>c.value).sort((a,b)=>a-b);
    const pool = cat.clues.map(({q,a})=>({q,a}));
    shuffleInPlace(pool);
    cat.clues = values.map((v, idx)=>({ value:v, q:pool[idx].q, a:pool[idx].a }));
  });

  // shuffle category order
  shuffleInPlace(fresh.categories);

  return fresh;
}

/** =========================
 *  HIDDEN DAILY DOUBLES
 *  ========================= */
function randomizeDailyDoubles(){
  state.dailyDoubleSet.clear();
  const spots = [];
  for(let c=0;c<gameData.categories.length;c++){
    for(let i=0;i<gameData.categories[c].clues.length;i++){
      spots.push({c,i,key:`${c}-${i}`});
    }
  }
  shuffleInPlace(spots);
  for(let n=0;n<state.dailyDoubleCount && n<spots.length;n++){
    state.dailyDoubleSet.add(spots[n].key);
  }
}

/** =========================
 *  BOARD + SCOREBOARD
 *  ========================= */
function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, s => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[s]));
}

function buildBoard(){
  boardEl.innerHTML = "";
  // category headers
  for(let c=0;c<gameData.categories.length;c++){
    const cat = document.createElement("div");
    cat.className = "cat";
    cat.innerHTML = `<span>${gameData.categories[c].name}</span>`;
    boardEl.appendChild(cat);
  }

  // tiles
  for(let row=0; row<5; row++){
    for(let c=0;c<gameData.categories.length;c++){
      const clue = gameData.categories[c].clues[row];
      const key = `${c}-${row}`;
      const tile = document.createElement("div");
      tile.className = "tile";
      tile.setAttribute("role","button");
      tile.setAttribute("tabindex","0");
      tile.dataset.c = String(c);
      tile.dataset.r = String(row);
      tile.textContent = state.used.has(key) ? "—" : `$${clue.value}`;
      if(state.used.has(key)) tile.classList.add("used");

      tile.addEventListener("click", () => {
        if(state.locked || state.used.has(key)) return;
        openClue(c, row);
      });

      tile.addEventListener("keydown",(e)=>{
        if(e.key === "Enter" || e.key === " "){
          e.preventDefault();
          if(state.locked || state.used.has(key)) return;
          openClue(c,row);
        }
      });

      boardEl.appendChild(tile);
    }
  }

  // focus first available tile (helps Fire TV remote)
  focusFirstAvailableTile();
}

function focusFirstAvailableTile(){
  const tiles = Array.from(boardEl.querySelectorAll(".tile"));
  const first = tiles.find(t => !t.classList.contains("used"));
  if(first) first.focus({preventScroll:true});
}

function formatScore(n){ return (n >= 0 ? "$" + n : "-$" + Math.abs(n)); }

function renderJudgeTeamSelects(){
  const opts = state.teams.map((t, i)=>`<option value="${i}">${escapeHtml(t.name)}</option>`).join("");
  judgeTeam.innerHTML = opts;
  finalJudgeTeam.innerHTML = opts;
}

function renderTeams(){
  teamsEl.innerHTML = "";
  state.teams.forEach((t, idx) => {
    const row = document.createElement("div");
    row.className = "team";
    row.innerHTML = `
      <div>
        <div class="teamName">
          <input type="text" value="${escapeHtml(t.name)}" aria-label="Team name ${idx+1}" data-teamname="${idx}">
          <span class="score" id="score-${idx}">${formatScore(t.score)}</span>
        </div>
      </div>
      <div class="scoreBtns">
        <button class="btn green" data-add="${idx}">+100</button>
        <button class="btn" data-sub="${idx}">-100</button>
        <button class="btn gold" data-addv="${idx}">+Clue</button>
        <button class="btn red" data-subv="${idx}">-Clue</button>
      </div>
    `;
    teamsEl.appendChild(row);
  });

  teamsEl.querySelectorAll("input[data-teamname]").forEach(inp => {
    inp.addEventListener("input", (e) => {
      const i = Number(e.target.dataset.teamname);
      state.teams[i].name = e.target.value;
      renderJudgeTeamSelects();
      renderSetupNames();
    });
  });

  teamsEl.querySelectorAll("button[data-add]").forEach(btn=>{
    btn.addEventListener("click", ()=>adjustScore(Number(btn.dataset.add), +100));
  });
  teamsEl.querySelectorAll("button[data-sub]").forEach(btn=>{
    btn.addEventListener("click", ()=>adjustScore(Number(btn.dataset.sub), -100));
  });
  teamsEl.querySelectorAll("button[data-addv]").forEach(btn=>{
    btn.addEventListener("click", ()=>adjustByCurrentClue(Number(btn.dataset.addv), +1));
  });
  teamsEl.querySelectorAll("button[data-subv]").forEach(btn=>{
    btn.addEventListener("click", ()=>adjustByCurrentClue(Number(btn.dataset.subv), -1));
  });

  renderJudgeTeamSelects();
}

function updateScores(){
  state.teams.forEach((t, idx)=>{
    const el = document.getElementById(`score-${idx}`);
    if(el) el.textContent = formatScore(t.score);
  });
}
function adjustScore(teamIndex, delta){
  state.teams[teamIndex].score += delta;
  updateScores();
}

function currentPointValue(){
  if(state.current){
    if(state.current.isDD && typeof state.current.clue.__wager === "number"){
      return state.current.clue.__wager;
    }
    return state.current.clue.value;
  }
  return 0;
}
function adjustByCurrentClue(teamIndex, multiplier){
  let amount = 0;
  if(finalModal.classList.contains("show")){
    amount = state.teams[teamIndex].wager || 0;
  } else if(state.current){
    amount = currentPointValue();
  } else {
    amount = 100;
  }
  adjustScore(teamIndex, multiplier * amount);
}

/** =========================
 *  TIMER
 *  ========================= */
function setTimerSeconds(sec){
  state.timer.seconds = Math.max(5, Math.min(120, sec));
}
function formatTime(s){
  const m = Math.floor(s / 60);
  const r = s % 60;
  return `${m}:${String(r).padStart(2,"0")}`;
}
function paintTime(){
  const t = state.timer.remaining;
  timeEl.textContent = formatTime(t);
  barTime.textContent = formatTime(t);

  timeEl.classList.remove("warn","danger");
  if(t <= 5) timeEl.classList.add("danger");
  else if(t <= 10) timeEl.classList.add("warn");
}
function maybeStartTimerMusic(){
  if(state.music.mode !== "timer") return;
  startThinkingLoop();
}
function maybeStopTimerMusic(){
  if(state.music.mode !== "timer") return;
  stopLoop(thinking);
}
function startTimer(){
  if(state.timer.running) return;
  state.timer.running = true;
  maybeStartTimerMusic();

  state.timer.interval = setInterval(()=>{
    state.timer.remaining -= 1;
    if(state.timer.remaining <= 0){
      state.timer.remaining = 0;
      paintTime();
      stopTimer();
      beep("timeup");
      hostSay("Time!", "Buzzer’s cold. Time’s up!", "time", 2200);
    } else {
      paintTime();
    }
  }, 1000);
}
function stopTimer(){
  state.timer.running = false;
  if(state.timer.interval) clearInterval(state.timer.interval);
  state.timer.interval = null;
  maybeStopTimerMusic();
}
function resetTimer(){
  stopTimer();
  state.timer.remaining = state.timer.seconds;
  paintTime();
}
document.getElementById("timerStart").addEventListener("click", ()=>{ startTimer(); hostSay("Clock’s Running", "Buzz in when you’re ready!", "wow", 1500); });
document.getElementById("timerPause").addEventListener("click", ()=>{ stopTimer(); hostSay("Paused", "Quick huddle. Resume when ready.", "sassy", 1500); });
document.getElementById("timerReset").addEventListener("click", ()=>{ resetTimer(); hostSay("Reset", "Fresh timer. New chance.", "happy", 1500); });
timerSeconds.addEventListener("change", ()=>{ setTimerSeconds(Number(timerSeconds.value) || 20); resetTimer(); });

/* host bar controls mirror */
barStart.addEventListener("click", startTimer);
barPause.addEventListener("click", stopTimer);
barReset.addEventListener("click", resetTimer);
barBuzz.addEventListener("click", ()=>{ beep("buzz"); hostSay("BUZZ!", "Somebody wants that point!", "buzz", 1200); });
barTimeUp.addEventListener("click", ()=>{ beep("timeup"); hostSay("Time’s Up!", "Stop the clock!", "time", 1600); });
barReveal.addEventListener("click", ()=>{ document.getElementById("btnReveal").click(); });
barClose.addEventListener("click", ()=>{ if(clueModal.classList.contains("show")) closeClue(true); });

/** =========================
 *  MODALS
 *  ========================= */
function setActiveTile(c, r){
  boardEl.querySelectorAll(".tile.active").forEach(t=>t.classList.remove("active"));
  const el = boardEl.querySelector(`.tile[data-c="${c}"][data-r="${r}"]`);
  if(el) el.classList.add("active");
}

function openClue(c, i){
  const cat = gameData.categories[c];
  const clue = cat.clues[i];
  const isDD = state.dailyDoubleSet.has(`${c}-${i}`);
  state.current = { c, i, clue, isDD };

  setActiveTile(c,i);

  answerText.classList.remove("show");
  clueText.textContent = clue.q;
  answerText.textContent = clue.a;

  clueMeta.textContent = `${cat.name} • $${clue.value}`;
  cluePill.textContent = isDD ? "Daily Double" : "Clue";
  btnWager.style.display = isDD ? "inline-flex" : "none";

  setTimerSeconds(Number(timerSeconds.value) || 20);
  resetTimer();

  clueModal.classList.add("show");
  hostSay(isDD ? "Daily Double!" : "New Clue!", isDD ? "Make your wager!" : "Okay teams… who’s got the holiday brainpower?", "wow", 2000);
}

function closeClue(markUsed=true){
  if(state.current && markUsed){
    state.used.add(`${state.current.c}-${state.current.i}`);
  }
  state.current = null;
  clueModal.classList.remove("show");
  stopTimer();
  buildBoard();
  hostSay("Next!", "Pick the next tile — keep it moving!", "sassy", 1600);
}

document.getElementById("btnReveal").addEventListener("click", ()=>{
  answerText.classList.toggle("show");
  hostSay(answerText.classList.contains("show") ? "Reveal!" : "Suspense…",
          answerText.classList.contains("show") ? "That’s the one — holiday knowledge confirmed." : "Back to mystery mode.",
          answerText.classList.contains("show") ? "happy" : "sassy",
          2000);
});
document.getElementById("btnClose").addEventListener("click", ()=>closeClue(true));
clueModal.addEventListener("click", (e)=>{ if(e.target === clueModal) closeClue(true); });

btnWager.addEventListener("click", ()=>{
  if(!state.current?.isDD) return;
  const maxWager = Math.max(...state.teams.map(t=>t.score), 0) + state.current.clue.value;
  const wager = prompt(`Daily Double! Enter wager (0 to ${maxWager}):`, String(state.current.clue.value));
  if(wager === null) return;
  const w = Math.max(0, Math.min(maxWager, Number(wager)||0));
  state.current.clue.__wager = w;
  cluePill.textContent = `Daily Double • Wager $${w}`;
  hostSay("Wager Locked!", `Big swing: $${w}.`, "wow", 2000);
});

btnFinal.addEventListener("click", ()=>{
  finalCategory.textContent = gameData.final.category;
  finalClue.textContent = gameData.final.clue;
  finalAnswer.textContent = gameData.final.answer;
  finalAnswer.classList.remove("show");
  finalModal.classList.add("show");
  hostSay("Final Jeopardy!", "Wagers in… may the best team win!", "wow", 2000);
});
finalRevealBtn.addEventListener("click", ()=>{
  finalAnswer.classList.toggle("show");
  hostSay(finalAnswer.classList.contains("show") ? "Final Reveal!" : "Hold it…",
          finalAnswer.classList.contains("show") ? "Time to score it out!" : "Suspense is a gift.",
          finalAnswer.classList.contains("show") ? "happy" : "sassy",
          2000);
});
finalCloseBtn.addEventListener("click", ()=>finalModal.classList.remove("show"));
finalModal.addEventListener("click",(e)=>{ if(e.target === finalModal) finalModal.classList.remove("show"); });

finalWagerBtn.addEventListener("click", ()=>{
  state.teams.forEach((t)=>{
    const maxW = Math.max(0, t.score);
    const w = prompt(`${t.name} wager (0 to ${maxW}):`, String(Math.min(200, maxW)));
    if(w === null) return;
    t.wager = Math.max(0, Math.min(maxW, Number(w)||0));
  });
  hostSay("Wagers Saved", "Now reveal, then judge each team.", "happy", 2400);
});

/** =========================
 *  JUDGE
 *  ========================= */
judgeCorrect.addEventListener("click", ()=>{
  const idx = Number(judgeTeam.value);
  const pts = currentPointValue();
  adjustScore(idx, +pts);
  beep("cheer");
  hostSay("Correct!", `${state.teams[idx].name} +$${pts}!`, "happy", 1800);
  closeClue(true);
});
judgeWrong.addEventListener("click", ()=>{
  const idx = Number(judgeTeam.value);
  const pts = currentPointValue();
  adjustScore(idx, -pts);
  beep("boo");
  hostSay("Nope!", `${state.teams[idx].name} -$${pts}.`, "oops", 1800);
  closeClue(true);
});
finalCorrect.addEventListener("click", ()=>{
  const idx = Number(finalJudgeTeam.value);
  const w = state.teams[idx].wager || 0;
  adjustScore(idx, +w);
  beep("cheer");
  hostSay("Final Correct!", `${state.teams[idx].name} +$${w}!`, "happy", 2000);
});
finalWrong.addEventListener("click", ()=>{
  const idx = Number(finalJudgeTeam.value);
  const w = state.teams[idx].wager || 0;
  adjustScore(idx, -w);
  beep("boo");
  hostSay("Final Wrong!", `${state.teams[idx].name} -$${w}.`, "oops", 2000);
});

/** =========================
 *  REMOTE-FRIENDLY NAV (D-pad arrows)
 *  Works on many TV browsers (arrow keys) + keyboards.
 *  ========================= */
function moveFocus(dc, dr){
  const active = document.activeElement;
  if(!(active && active.classList && active.classList.contains("tile"))) return;
  const c = Number(active.dataset.c);
  const r = Number(active.dataset.r);
  const nc = Math.max(0, Math.min(5, c + dc));
  const nr = Math.max(0, Math.min(4, r + dr));
  const next = boardEl.querySelector(`.tile[data-c="${nc}"][data-r="${nr}"]`);
  if(next) next.focus({preventScroll:true});
}

/** =========================
 *  BUZZER + HOTKEYS
 *  ========================= */
btnBuzz.addEventListener("click", ()=>{
  beep("buzz");
  hostSay("BUZZ!", "Somebody wants that point!", "buzz", 1200);
});
btnTimeUp.addEventListener("click", ()=>{
  beep("timeup");
  hostSay("Time’s Up!", "Stop the clock!", "time", 1600);
});

document.addEventListener("keydown", (e)=>{
  // Fire TV: arrow keys often exist (or keyboard connected)
  if(!clueModal.classList.contains("show") && !finalModal.classList.contains("show") && !setupModal.classList.contains("show")){
    if(e.key === "ArrowLeft"){ e.preventDefault(); moveFocus(-1,0); }
    if(e.key === "ArrowRight"){ e.preventDefault(); moveFocus(1,0); }
    if(e.key === "ArrowUp"){ e.preventDefault(); moveFocus(0,-1); }
    if(e.key === "ArrowDown"){ e.preventDefault(); moveFocus(0,1); }
  }

  if(e.code === "Space"){
    // On TV remotes, Space may map; keep it as buzz
    if(clueModal.classList.contains("show") || finalModal.classList.contains("show")){
      e.preventDefault();
      beep("buzz");
      hostSay("BUZZ!", "Spacebar buzz! Who’s answering?", "buzz", 1200);
    }
  }
  if(e.key === "Escape" || e.key === "Backspace"){
    if(clueModal.classList.contains("show")) closeClue(true);
    if(finalModal.classList.contains("show")) finalModal.classList.remove("show");
    if(setupModal.classList.contains("show")) setupModal.classList.remove("show");
  }
});

/** =========================
 *  LOCK + RESET + TEAM COUNT
 *  ========================= */
btnLock.addEventListener("click", ()=>{
  state.locked = !state.locked;
  btnLock.textContent = `Lock Board: ${state.locked ? "ON" : "OFF"}`;
  hostSay(state.locked ? "Locked" : "Unlocked",
          state.locked ? "Host mode ON. No tile tapping!" : "Board is live. Tap away!",
          state.locked ? "sassy" : "happy",
          1800);
});

function resetGame({shuffle=true}={}){
  state.used.clear();
  state.teams.forEach(t=>{ t.score = 0; t.wager = 0; });
  stopAllMusic();

  gameData = shuffle ? buildShuffledGame() : structuredClone(BASE_GAME_DATA);
  randomizeDailyDoubles();

  updateScores();
  buildBoard();
  hostSay("Fresh Game!", shuffle ? "New shuffled board! Same holiday chaos!" : "New game! Same holiday chaos!", "happy", 2200);
}

btnReset.addEventListener("click", ()=>{
  if(!confirm("Reset the board + scores? (This also shuffles the game.)")) return;
  resetGame({shuffle:true});
});

function setTeamCount(n){
  const old = state.teams;
  state.teams = Array.from({length:n}, (_,i)=> old[i] ? old[i] : ({ name:`Team ${i+1}`, score:0, wager:0 }));
  renderTeams();
  updateScores();
  renderSetupNames();
}
teamCountEl.addEventListener("change", ()=>setTeamCount(Number(teamCountEl.value)));

/** =========================
 *  MUSIC UI
 *  ========================= */
timerMusicOnlyEl.addEventListener("change", ()=>setMusicMode());
musicPlayBtn.addEventListener("click", ()=>{
  if(state.music.mode === "timer"){
    hostSay("Music Ready", "Timer-only mode. Start the timer to hear it.", "happy", 2000);
    if(state.timer.running) startThinkingLoop();
  } else {
    startMusicLoop();
    hostSay("Music On", "Game-show vibes activated.", "happy", 2000);
  }
});
musicStopBtn.addEventListener("click", ()=>{
  stopAllMusic();
  hostSay("Music Off", "Silent night… until you hit play again.", "sassy", 2000);
});
musicVolEl.addEventListener("change", updateMusicVolume);

/** =========================
 *  FESTIVE LANE
 *  ========================= */
sleighWrapEl.addEventListener("animationiteration", ()=>{
  hostSay("Ho Ho Ho!", "Merry quizz-mas! Next pick!", "happy", 1600);
});
snowmanEl.addEventListener("click", ()=>{
  snowmanEl.classList.toggle("fallen");
  hostSay(
    snowmanEl.classList.contains("fallen") ? "Uh-oh!" : "Back up!",
    snowmanEl.classList.contains("fallen") ? "Frosty took a tumble. He’s fine!" : "Shake it off, Frosty!",
    snowmanEl.classList.contains("fallen") ? "oops" : "happy",
    1500
  );
});
function confettiBurst(x,y){
  const n = 18;
  for(let i=0;i<n;i++){
    const p = document.createElement("div");
    p.className = "confetti";
    p.style.left = (x) + "px";
    p.style.top = (y) + "px";
    p.style.background = `hsl(${Math.random()*360},90%,60%)`;
    laneEl.appendChild(p);

    const ang = Math.random()*Math.PI*2;
    const dist = 30 + Math.random()*80;
    const tx = Math.cos(ang)*dist;
    const ty = Math.sin(ang)*dist - 30;
    const dur = 650 + Math.random()*500;

    p.animate([
      { transform:`translate(0,0)`, opacity:1 },
      { transform:`translate(${tx}px, ${ty}px)`, opacity:0 }
    ], { duration: dur, easing:"cubic-bezier(.22,.7,.36,1)" });

    setTimeout(()=>p.remove(), dur+60);
  }
}
giftEl.addEventListener("click", ()=>{
  const gx = giftEl.getBoundingClientRect();
  const lx = laneEl.getBoundingClientRect();
  const x = (gx.left - lx.left) + gx.width/2;
  const y = (gx.top - lx.top) + gx.height/2;
  confettiBurst(x,y);
  hostSay("Surprise!", "Gift popped some cheer!", "wow", 1400);
});

/** =========================
 *  SETUP MODAL
 *  ========================= */
function renderSetupNames(){
  setupNames.innerHTML = "";
  state.teams.forEach((t, idx)=>{
    const div = document.createElement("div");
    div.className = "setupRow";
    div.innerHTML = `
      <div class="setupCard">
        <div class="mini">Team ${idx+1} Name</div>
        <input type="text" data-setupname="${idx}" value="${escapeHtml(t.name)}" />
      </div>
      <div class="setupCard">
        <div class="mini">Starting Score</div>
        <input type="number" data-setscore="${idx}" value="${t.score}" />
      </div>
    `;
    setupNames.appendChild(div);
  });

  setupNames.querySelectorAll("input[data-setupname]").forEach(inp=>{
    inp.addEventListener("input",(e)=>{
      const i = Number(e.target.dataset.setupname);
      state.teams[i].name = e.target.value;
      renderTeams();
    });
  });
  setupNames.querySelectorAll("input[data-setscore]").forEach(inp=>{
    inp.addEventListener("change",(e)=>{
      const i = Number(e.target.dataset.setscore);
      state.teams[i].score = Number(e.target.value) || 0;
      updateScores();
      renderTeams();
    });
  });
}
btnSetup.addEventListener("click", ()=>{
  setupTeamCount.value = String(state.teams.length);
  renderSetupNames();
  setupModal.classList.add("show");
});
setupClose.addEventListener("click", ()=>setupModal.classList.remove("show"));
setupModal.addEventListener("click",(e)=>{ if(e.target === setupModal) setupModal.classList.remove("show"); });

setupTeamCount.addEventListener("change", ()=>{
  setTeamCount(Number(setupTeamCount.value));
  teamCountEl.value = String(state.teams.length);
});

setupStart.addEventListener("click", ()=>{
  setupModal.classList.remove("show");
  resetGame({shuffle: setupShuffle.checked});
});

/** =========================
 *  TV MODE + HOST MODE TOGGLES
 *  ========================= */
function applyTVMode(on){
  state.tvMode = on;
  document.body.classList.toggle("tv", on);
  btnTV.textContent = `TV Mode: ${on ? "ON" : "OFF"}`;
  if(on){
    hostSay("TV Mode", "Big screen readability boosted.", "happy", 1700);
  } else {
    hostSay("TV Mode", "Standard layout restored.", "sassy", 1700);
  }
}
function applyHostMode(on){
  state.hostMode = on;
  document.body.classList.toggle("host", on);
  btnHostMode.textContent = `Host Mode: ${on ? "ON" : "OFF"}`;
  hostSay("Host Mode", on ? "On-screen host controls enabled." : "Host bar hidden.", "happy", 1700);
}

btnTV.addEventListener("click", ()=>applyTVMode(!state.tvMode));
btnHostMode.addEventListener("click", ()=>applyHostMode(!state.hostMode));

/* Auto TV mode if on large screen */
(function autoTV(){
  const bigScreen = window.matchMedia("(min-width: 1100px)").matches;
  if(bigScreen){
    applyTVMode(true);
    applyHostMode(true);  // helpful on TV
  }
})();

/** =========================
 *  INIT
 *  ========================= */
(function init(){
  setMusicMode();
  setTimerSeconds(Number(timerSeconds.value) || 20);
  resetTimer();

  renderTeams();
  renderSetupNames();

  // Start with a shuffled board by default
  resetGame({shuffle:true});

  hostSay("Welcome!", "Pick a category and let’s jingle these points!", "happy", 2200);

  // show setup once on load
  setupModal.classList.add("show");
})();
</script>
</body>
</html>
