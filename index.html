<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Claudio's Christmas Jeopardy</title><style>
  :root{
    --bg:#060612;
    --panel: rgba(255,255,255,.06);
    --panel2: rgba(255,255,255,.04);
    --text:#f2f5ff;
    --muted:#cfe0ff;

    --neon:#00e5ff;
    --pink:#ff2bd6;
    --green:#7CFF6B;
    --gold:#ffd24a;
    --red:#ff4d4d;

    --ice:#bfe9ff;

    --radius:18px;
    --shadow: 0 0 14px rgba(0,229,255,.35), 0 0 34px rgba(255,43,214,.14);
    --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;

    --focus: rgba(255,210,74,.95);
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:var(--font);
    color:var(--text);

    /* upgraded “winter sky + aurora + stars” background */
    background:
      radial-gradient(900px 520px at 15% 10%, rgba(0,229,255,.20), transparent 62%),
      radial-gradient(900px 520px at 90% 16%, rgba(255,43,214,.16), transparent 62%),
      radial-gradient(800px 520px at 55% 95%, rgba(45,255,106,.12), transparent 62%),
      radial-gradient(1200px 800px at 50% 50%, rgba(255,210,74,.06), transparent 70%),
      linear-gradient(180deg, #07071a, #04040c 70%, #04040c);

    overflow-x:hidden;
  }

  /* subtle starfield layer */
  .stars{
    position:fixed; inset:0; pointer-events:none; z-index:0;
    opacity:.45;
    background:
      radial-gradient(1px 1px at 12% 22%, rgba(255,255,255,.90), transparent 55%),
      radial-gradient(1px 1px at 24% 68%, rgba(191,233,255,.90), transparent 55%),
      radial-gradient(1px 1px at 36% 30%, rgba(255,255,255,.75), transparent 55%),
      radial-gradient(1px 1px at 52% 12%, rgba(255,255,255,.85), transparent 55%),
      radial-gradient(1px 1px at 68% 26%, rgba(191,233,255,.75), transparent 55%),
      radial-gradient(1px 1px at 76% 70%, rgba(255,255,255,.80), transparent 55%),
      radial-gradient(1px 1px at 90% 18%, rgba(255,255,255,.92), transparent 55%),
      radial-gradient(1px 1px at 92% 62%, rgba(191,233,255,.85), transparent 55%);
    filter: drop-shadow(0 0 10px rgba(191,233,255,.10));
  }

  /* aurora glow sweep */
  .aurora{
    position:fixed; inset:-20%;
    pointer-events:none; z-index:0;
    background:
      radial-gradient(900px 500px at 25% 30%, rgba(0,229,255,.10), transparent 70%),
      radial-gradient(900px 500px at 70% 40%, rgba(255,43,214,.08), transparent 70%),
      radial-gradient(900px 500px at 55% 65%, rgba(45,255,106,.08), transparent 70%);
    mix-blend-mode: screen;
    filter: blur(18px);
    opacity:.55;
    animation: auroraDrift 12s ease-in-out infinite alternate;
  }
  @keyframes auroraDrift{
    0%{ transform: translate3d(-1%, -1%, 0) rotate(-1deg); opacity:.45; }
    100%{ transform: translate3d(1%, 1%, 0) rotate(1deg); opacity:.62; }
  }

  /* ===== Snowflakes (SVG flakes) ===== */
  .snow{position:fixed; inset:0; pointer-events:none; z-index:1; opacity:.70}
  .flake{
    position:absolute; top:-40px;
    width:18px; height:18px;
    will-change: transform, opacity;
    animation: fall linear infinite;
    opacity:.9;
  }
  .flake svg{width:100%; height:100%;}
  @keyframes fall{
    to{
      transform:
        translateY(115vh)
        translateX(var(--drift, 0px))
        rotate(var(--rotEnd, 240deg));
      opacity:.10;
    }
  }

  .wrap{max-width:1240px;margin:0 auto;padding:16px 14px 28px; position:relative; z-index:2}
  header{
    display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;
    padding:8px 2px 14px;
  }
  .brand{display:flex;align-items:center;gap:12px}
  .badge{
    width:52px;height:52px;border-radius:18px;
    background: linear-gradient(135deg, rgba(255,59,59,.95), rgba(45,255,106,.75));
    box-shadow: 0 0 0 1px rgba(255,255,255,.12), var(--shadow);
    position:relative;
  }
  .badge:after{
    content:"";
    position:absolute; inset:10px;
    border-radius:12px;
    border:2px solid rgba(255,255,255,.35);
  }

  /* ===== Title glitter effect ===== */
  .titleWrap{display:flex;flex-direction:column;gap:2px; position:relative}
  h1{
    margin:0;
    font-size:34px;
    line-height:1.05;
    letter-spacing:.6px;
    font-weight:1200;
    text-shadow:
      0 0 18px rgba(0,229,255,.22),
      0 0 22px rgba(255,43,214,.16),
      0 0 34px rgba(255,210,74,.12);
    position:relative;
    display:inline-block;
    padding:4px 6px;
  }
  h1::before{
    content:"";
    position:absolute;
    inset:-10px -14px -12px -14px;
    border-radius:18px;
    background:
      radial-gradient(200px 80px at 20% 40%, rgba(255,210,74,.25), transparent 60%),
      radial-gradient(220px 90px at 80% 60%, rgba(0,229,255,.22), transparent 60%),
      linear-gradient(90deg, rgba(255,43,214,.10), rgba(0,229,255,.10), rgba(45,255,106,.08));
    opacity:.95;
    z-index:-2;
    animation: glowSweep 4.8s ease-in-out infinite;
    border:1px solid rgba(255,255,255,.10);
  }
  h1::after{
    content:"";
    position:absolute;
    inset:-14px -18px -16px -18px;
    border-radius:20px;
    background:
      radial-gradient(2px 2px at 10% 25%, rgba(255,255,255,.95), transparent 60%),
      radial-gradient(2px 2px at 22% 70%, rgba(191,233,255,.95), transparent 60%),
      radial-gradient(2px 2px at 40% 35%, rgba(255,210,74,.95), transparent 60%),
      radial-gradient(2px 2px at 55% 65%, rgba(255,255,255,.92), transparent 60%),
      radial-gradient(2px 2px at 70% 30%, rgba(0,229,255,.95), transparent 60%),
      radial-gradient(2px 2px at 88% 60%, rgba(255,43,214,.95), transparent 60%),
      radial-gradient(2px 2px at 92% 25%, rgba(255,255,255,.92), transparent 60%);
    opacity:.55;
    z-index:-1;
    animation: twSpark 2.6s ease-in-out infinite;
    pointer-events:none;
  }
  @keyframes glowSweep{
    0%,100%{transform: translateY(0px); filter: brightness(1) blur(0.2px)}
    50%{transform: translateY(-1px); filter: brightness(1.25) blur(0.3px)}
  }
  @keyframes twSpark{
    0%,100%{opacity:.40; filter: brightness(1)}
    50%{opacity:.78; filter: brightness(1.35)}
  }

  .sub{
    margin-top:2px;
    color:var(--muted);
    font-size:13px;
    letter-spacing:.35px;
    font-weight:900;
  }

  .topbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{
    cursor:pointer;border:none;border-radius:14px;
    padding:10px 12px;
    font-weight:900;letter-spacing:.2px;
    color:var(--text);
    background: linear-gradient(135deg, rgba(0,229,255,.20), rgba(255,43,214,.14));
    border:1px solid rgba(255,255,255,.12);
    box-shadow: 0 0 0 1px rgba(0,229,255,.10);
    user-select:none;
    transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
  }
  .btn:hover{transform: translateY(-1px); box-shadow: var(--shadow)}
  .btn:active{transform: translateY(0px) scale(.99); filter:brightness(.95)}
  .btn.red{background: linear-gradient(135deg, rgba(255,59,59,.24), rgba(255,43,214,.10));}
  .btn.green{background: linear-gradient(135deg, rgba(45,255,106,.20), rgba(0,229,255,.10));}
  .btn.gold{background: linear-gradient(135deg, rgba(255,210,74,.22), rgba(255,43,214,.10));}
  .btn.ghost{background: rgba(0,0,0,.18);}

  .layout{display:grid;grid-template-columns:1fr 410px;gap:14px;align-items:start}
  @media(max-width: 980px){.layout{grid-template-columns:1fr}}

  .panel{
    background: var(--panel);
    border:1px solid rgba(255,255,255,.10);
    border-radius: var(--radius);
    box-shadow: 0 0 0 1px rgba(255,255,255,.04), 0 18px 55px rgba(0,0,0,.45);
    padding:14px;
  }

  .grid{display:grid;grid-template-columns:repeat(6, 1fr);gap:10px}
  @media(max-width: 980px){.grid{grid-template-columns:repeat(3,1fr)}}
  @media(max-width: 520px){.grid{grid-template-columns:repeat(2,1fr)}}

  .cat{
    background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
    border:1px solid rgba(255,255,255,.10);
    border-radius: 16px;
    padding:10px 8px;
    text-align:center;
    font-weight:1100;
    font-size:12px;
    letter-spacing:.6px;
    text-transform:uppercase;
    position:relative;
    overflow:hidden;
  }
  .cat:before{
    content:"";
    position:absolute; inset:-40%;
    background: conic-gradient(from 120deg, transparent, rgba(255,59,59,.18), transparent, rgba(45,255,106,.18), transparent);
    animation: spin 10s linear infinite;
    opacity:.7;
  }
  .cat > span{position:relative}
  @keyframes spin{to{transform:rotate(360deg)}}

  .tile{
    height:84px;border-radius:18px;
    background: linear-gradient(180deg, rgba(17,17,70,.95), rgba(10,10,40,.95));
    border:1px solid rgba(255,255,255,.12);
    display:flex;align-items:center;justify-content:center;
    font-weight:1100;font-size:26px;
    color: rgba(255,210,74,.95);
    text-shadow: 0 0 18px rgba(255,210,74,.22), 0 0 16px rgba(0,229,255,.14);
    cursor:pointer;user-select:none;
    transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease, outline .08s ease;
    position:relative;
    overflow:hidden;
  }
  .tile:hover{transform: translateY(-2px); box-shadow: var(--shadow)}
  .tile.used{opacity:.22;cursor:not-allowed;filter:saturate(.6);text-shadow:none}
  .tile:focus{
    outline: 4px solid rgba(255,210,74,.85);
    box-shadow: 0 0 0 2px rgba(0,0,0,.35), var(--shadow);
    transform: translateY(-2px);
  }
  .tile.active{
    outline: 4px solid rgba(0,229,255,.85);
    box-shadow: 0 0 0 2px rgba(0,0,0,.35), var(--shadow);
  }

  .side{display:grid;gap:14px}
  .sectionTitle{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:0 0 10px;font-weight:1100}
  .mini{font-size:12px;color:var(--muted);font-weight:800}

  /* ===== TV MODE (Big screen readability) ===== */
  body.tv .wrap{max-width:1600px}
  body.tv h1{font-size:42px}
  body.tv .sub{font-size:16px}
  body.tv .tile{height:110px; font-size:34px}
  body.tv .cat{font-size:14px; padding:14px 10px}
  body.tv .layout{grid-template-columns: 1fr; }
  body.tv .side{display:none;}          /* hide side panel on TV */
  body.tv .panel{padding:16px;}

  /* ===== HOST MODE BAR (TV control overlay) ===== */
  .hostBar{
    position:fixed;
    left:14px; right:14px; bottom:14px;
    z-index:70;
    display:none;
    gap:10px;
    padding:12px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.34);
    backdrop-filter: blur(10px);
    box-shadow: 0 18px 55px rgba(0,0,0,.55);
  }
  body.host .hostBar{display:flex;}
  .hostBar .btn{padding:12px 14px; border-radius:14px;}
  .hostBar .cluster{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
  .hostBar .grow{flex:1}
  .hostBar .stat{
    padding:10px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    font-weight:1000;
    letter-spacing:.2px;
  }
  .hostBar .stat b{color: var(--gold)}
  .hostBar .small{font-size:12px; color:var(--muted); font-weight:900}

  /* ===== AUDIO UNLOCK OVERLAY (for Fire TV browsers) ===== */
  .unlock{
    position:fixed; inset:0; z-index:80;
    display:none; align-items:center; justify-content:center;
    background: rgba(0,0,0,.72);
    backdrop-filter: blur(6px);
    padding:18px;
  }
  .unlock.show{display:flex;}
  .unlockCard{
    width:min(720px, 100%);
    border-radius:22px;
    border:1px solid rgba(255,255,255,.14);
    background: linear-gradient(180deg, rgba(18,18,74,.96), rgba(13,13,42,.96));
    box-shadow: 0 30px 90px rgba(0,0,0,.65);
    padding:18px;
  }
  .unlockCard h2{margin:0 0 8px; font-size:22px}
  .unlockCard p{margin:0 0 14px; color:var(--muted); font-weight:800; line-height:1.35}
  .unlockCard .btn{width:100%; padding:14px; font-size:16px}

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce){
    .flake, .aurora, h1::before, h1::after{ animation: none !important; }
  }
</style></head><body>
  <div class="stars" aria-hidden="true"></div>
  <div class="aurora" aria-hidden="true"></div>
  <div class="snow" id="snow" aria-hidden="true"></div>  <div class="wrap">
    <header>
      <div class="brand">
        <div class="badge" aria-hidden="true"></div>
        <div class="titleWrap">
          <h1>Claudio’s Christmas Jeopardy</h1>
          <div class="sub">May The Smartest Elf Win</div>
        </div>
      </div><div class="topbar">
    <button class="btn" id="btnSetup">Setup</button>
    <button class="btn ghost" id="btnTV">TV Mode: OFF</button>
    <button class="btn ghost" id="btnHostMode">Host Mode: OFF</button>
    <button class="btn ghost" id="btnAuto">Auto Timer: OFF</button>
    <button class="btn" id="btnLock">Lock Board: OFF</button>
    <button class="btn gold" id="btnFinal">Final Jeopardy</button>
    <button class="btn red" id="btnReset">Reset Game</button>
  </div>
</header>

<div class="layout">
  <section class="panel">
    <div class="grid" id="board" aria-label="Jeopardy board"></div>

    <div class="hint" style="margin-top:12px;">
      Remote tips: use D-pad to move tiles; press <b>Select/Enter</b> to open. Press <b>Back/Esc</b> to close.
    </div>
  </section>

  <aside class="side">
    <!-- Host / Timer / Buzzer / Music / Scoreboard panels are in the original enhanced version.
         This canvas focuses on fixing the state initialization bug without altering your existing game logic. -->
    <div class="panel">
      <div class="sectionTitle">Side Panel <span class="mini">(placeholder)</span></div>
      <div class="mini">If you previously had the full side-panel markup here, paste it back in — the fix below is JS-only.</div>
    </div>
  </aside>
</div>

  </div>  <!-- HOST MODE BAR (TV overlay controls) -->  <div class="hostBar" id="hostBar" aria-label="Host controls">
    <div class="cluster grow">
      <div class="stat"><span class="small">Timer</span> <b id="barTime">0:20</b></div>
      <button class="btn green" id="barStart">Start</button>
      <button class="btn" id="barPause">Pause</button>
      <button class="btn red" id="barReset">Reset</button>
      <button class="btn" id="barBuzz">Buzz</button>
      <button class="btn red" id="barTimeUp">Time’s Up</button>
    </div>
    <div class="cluster">
      <button class="btn" id="barAuto">Auto: OFF</button>
      <button class="btn" id="barReveal">Reveal</button>
      <button class="btn red" id="barClose">Close</button>
    </div>
  </div>  <!-- AUDIO UNLOCK OVERLAY -->  <div class="unlock" id="unlock">
    <div class="unlockCard">
      <h2>Enable Sound</h2>
      <p>
        Some TV browsers block audio until you click once.
        Hit the button below to enable buzzers + music.
      </p>
      <button class="btn green" id="unlockBtn">Enable Sound</button>
      <div class="mini" style="margin-top:10px;">You can still play silently if you prefer.</div>
    </div>
  </div><script>
  /**
   * FIX: Initialize `state` BEFORE any code reads or writes to it.
   *
   * Your previous file referenced `state.autoMode = false;` in an "additions" block,
   * but `state` didn't exist yet, causing:
   *   ReferenceError: state is not defined
   */
  let state = { autoMode: false };

  // --- The following functions are lightweight fallbacks so this file can run even
  // --- if you haven't pasted the rest of your original enhanced script yet.
  // --- When you paste your full script back in, these will be overwritten by your real implementations.
  function hostSay(title, msg){
    // no-op fallback (prevents errors if hostSay isn't present yet)
    console.log(`[HOST] ${title}: ${msg}`);
  }
  function startTimer(){
    // no-op fallback
    console.log('[TIMER] startTimer()');
  }
  // If your original script defines openClue, it will override this fallback.
  function openClue(){
    console.log('[CLUE] openClue()');
  }

  // ===== Auto Timer Controls (safe even if the rest of the game logic is not yet present) =====
  const btnAuto = document.getElementById('btnAuto');
  const barAuto = document.getElementById('barAuto');

  function setAuto(on){
    state.autoMode = !!on;
    if(btnAuto) btnAuto.textContent = `Auto Timer: ${state.autoMode ? 'ON' : 'OFF'}`;
    if(barAuto) barAuto.textContent = `Auto: ${state.autoMode ? 'ON' : 'OFF'}`;
    hostSay(
      'Auto Mode',
      state.autoMode ? 'Timer starts as soon as a clue opens.' : 'Manual timer control restored.'
    );
  }

  btnAuto?.addEventListener('click', ()=> setAuto(!state.autoMode));
  barAuto?.addEventListener('click', ()=> setAuto(!state.autoMode));

  // Hook into openClue to auto-start timer
  const _openClue = openClue;
  openClue = function(c,i){
    _openClue(c,i);
    if(state.autoMode) startTimer();
  };

  // Keyboard: A toggles auto
  document.addEventListener('keydown', (e)=>{
    if(e.key?.toLowerCase() === 'a') setAuto(!state.autoMode);
  });

  // Keep buttons in sync after init
  setAuto(state.autoMode);

  // ===== Minimal runtime tests (console assertions) =====
  // These are not unit tests in a runner, but they do protect against regressions.
  (function runSelfTests(){
    try{
      console.assert(typeof state === 'object' && state !== null, 'state should be an object');
      console.assert('autoMode' in state, 'state.autoMode should exist');

      const before = state.autoMode;
      setAuto(!before);
      console.assert(state.autoMode === !before, 'setAuto should toggle state.autoMode');
      setAuto(before);
      console.assert(state.autoMode === before, 'setAuto should restore state.autoMode');

      console.log('%cSelf-tests passed ✔', 'font-weight:900');
    }catch(err){
      console.error('Self-tests failed:', err);
    }
  })();
</script><!--
  IMPORTANT:
  Paste your full original enhanced script BELOW this comment (or merge it into the script above)
  but keep the `let state = { autoMode: false };` line near the top.
--></body>
</html>
